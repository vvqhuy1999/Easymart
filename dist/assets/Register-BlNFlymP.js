import{_ as $,r as u,h as E,x as D,m as L,c as m,a as s,d as b,g as k,t as F,f as c,w as B,s as g,v as O,M as I,N as J,i as G,j,k as W,o as f}from"./index-DQ4OBKkW.js";import{G as z,F as H}from"./FacebookSignIn-K-Y21kuE.js";const K={class:"d-flex justify-content-center align-items-center",style:{"min-height":"80vh",background:"#f8fafc"}},Q={class:"card shadow p-4 border-0",style:{"max-width":"400px",width:"100%","border-radius":"1.5rem"}},X={key:0,class:"text-center mb-3"},Y={key:1,class:"alert alert-danger",role:"alert"},Z={key:2,class:"alert alert-success",role:"alert"},ee={class:"mb-3"},se={class:"input-group"},te={class:"mb-3"},ae={class:"input-group"},oe={class:"mb-3"},le={class:"input-group"},ne={class:"mb-3"},re={class:"input-group"},ie={class:"mb-3"},ue={class:"input-group"},de=["type"],ce={class:"mb-3"},ge={class:"input-group"},ve=["type"],pe={class:"mb-3 form-check"},me=["disabled"],fe={key:0,class:"fas fa-user-plus me-2"},he={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},be={__name:"Register",setup(ke){const y=L(),{register:T,registerWithGoogle:P,registerWithFacebook:R,handleOAuth2Callback:U}=D(),v=u(""),h=u(""),d=u(""),p=u(""),x=u(""),w=u(""),N=u(!1),S=u(!1),C=u(!1),t=u(!1),n=u(""),o=u("");E(async()=>{const a=new URLSearchParams(window.location.search),e=a.get("google"),A=a.get("facebook"),r=a.get("oauth"),V=a.get("code");if(V){console.log("Detected OAuth2 callback in Register with code:",V),t.value=!0,o.value="Đang xử lý đăng ký OAuth2...";try{const i=await U();i&&i.success?(o.value=`Chào mừng ${i.user.name}! Đăng ký thành công. Đang chuyển hướng...`,window.history.replaceState({},document.title,window.location.pathname),setTimeout(()=>{y.push("/")},2e3)):i&&!i.success&&(n.value=i.error||"OAuth2 callback thất bại")}catch(i){console.error("OAuth2 callback error in Register:",i),n.value="Có lỗi xảy ra khi xử lý OAuth2 callback"}finally{t.value=!1}return}if(e==="pending"){const i=sessionStorage.getItem("pending-google-credential");if(i)try{const l=JSON.parse(atob(i.split(".")[1]));v.value=l.name||"",h.value=l.email||"",d.value=l.phone||"",p.value=l.address||"",o.value="Thông tin từ Google đã được điền sẵn. Nhấn đăng ký với Google để tiếp tục.",sessionStorage.removeItem("pending-google-credential")}catch(l){console.error("Error processing pending Google credential:",l),sessionStorage.removeItem("pending-google-credential")}}if(A==="pending"){const i=sessionStorage.getItem("pending-facebook-credential");if(i)try{const l=JSON.parse(atob(i.split(".")[1]));v.value=l.name||"",d.value=l.phone||"",p.value=l.address||"",o.value="Thông tin từ Facebook đã được điền sẵn. Nhấn đăng ký với Facebook để tiếp tục.",sessionStorage.removeItem("pending-facebook-credential")}catch(l){console.error("Error processing pending Facebook credential:",l),sessionStorage.removeItem("pending-facebook-credential")}}if(r==="pending"){const i=sessionStorage.getItem("pending-oauth-user-info");if(i)try{const l=JSON.parse(i);v.value=l.name||"",h.value=l.email||"",d.value=l.phone||"",p.value=l.address||"",o.value="Thông tin từ OAuth đã được điền sẵn. Vui lòng hoàn tất đăng ký.",sessionStorage.removeItem("pending-oauth-user-info")}catch(l){console.error("Error processing pending OAuth user info:",l),sessionStorage.removeItem("pending-oauth-user-info")}}});async function M(){if(n.value="",o.value="",x.value!==w.value){n.value="Mật khẩu không khớp!";return}if(d.value&&!/^[0-9]{10,11}$/.test(d.value.replace(/\s/g,""))){n.value="Số điện thoại không hợp lệ! Vui lòng nhập 10-11 chữ số.";return}if(!N.value){n.value="Vui lòng đồng ý với điều khoản sử dụng!";return}t.value=!0;try{const a=await T(v.value,h.value,d.value,x.value,w.value,p.value);a.success?(o.value=a.message||"Đăng ký thành công! Vui lòng đăng nhập để tiếp tục.",setTimeout(()=>{y.push("/login")},2e3)):n.value=a.error||"Đăng ký thất bại"}catch{n.value="Có lỗi xảy ra, vui lòng thử lại"}finally{t.value=!1}}async function _(a){n.value="",o.value="";try{if(!a.success){n.value=a.error||"Đăng ký với Google thất bại";return}if(a.redirect){o.value=a.message||"Đang chuyển hướng tới Google OAuth2...",t.value=!0;return}const e=await P(a);if(e.success)if(e.redirect){o.value=e.message||"Đang chuyển hướng tới Google OAuth2...",t.value=!0;return}else e.user&&(o.value=`Chào mừng ${e.user.name}! Đăng ký thành công. Đang chuyển hướng...`,setTimeout(()=>{y.push("/")},2e3));else n.value=e.error||"Đăng ký với Google thất bại"}catch(e){console.error("Google register error:",e),n.value="Có lỗi xảy ra, vui lòng thử lại"}finally{o.value.includes("chuyển hướng tới Google OAuth2")||(t.value=!1)}}async function q(a){n.value="",o.value="";try{if(!a.success){n.value=a.error||"Đăng ký với Facebook thất bại";return}if(a.redirect){o.value=a.message||"Đang chuyển hướng tới Facebook OAuth2...",t.value=!0;return}const e=await R(a);if(e.success)if(e.redirect){o.value=e.message||"Đang chuyển hướng tới Facebook OAuth2...",t.value=!0;return}else e.user&&(o.value=`Chào mừng ${e.user.name}! Đăng ký thành công. Đang chuyển hướng...`,setTimeout(()=>{y.push("/")},2e3));else n.value=e.error||"Đăng ký với Facebook thất bại"}catch(e){console.error("Facebook register error:",e),n.value="Có lỗi xảy ra, vui lòng thử lại"}finally{o.value.includes("chuyển hướng tới Facebook OAuth2")||(t.value=!1)}}return(a,e)=>{const A=W("router-link");return f(),m("div",null,[s("div",K,[s("div",Q,[e[28]||(e[28]=s("h2",{class:"mb-4 text-center text-primary fw-bold"},"Đăng ký",-1)),t.value?(f(),m("div",X,e[9]||(e[9]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Đang đăng ký...")],-1),s("p",{class:"mt-2 text-muted"},"Đang xử lý...",-1)]))):b("",!0),n.value?(f(),m("div",Y,[e[10]||(e[10]=s("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),k(F(n.value),1)])):b("",!0),o.value?(f(),m("div",Z,[e[11]||(e[11]=s("i",{class:"fas fa-check-circle me-2"},null,-1)),k(F(o.value),1)])):b("",!0),s("form",{onSubmit:B(M,["prevent"]),class:c({"d-none":t.value})},[s("div",ee,[e[13]||(e[13]=s("label",{for:"name",class:"form-label"},"Họ và tên",-1)),s("div",se,[e[12]||(e[12]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-user"})],-1)),g(s("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>v.value=r),type:"text",class:"form-control",id:"name",required:"",autocomplete:"name",placeholder:"Nhập họ và tên của bạn"},null,512),[[O,v.value]])])]),s("div",te,[e[15]||(e[15]=s("label",{for:"email",class:"form-label"},"Email",-1)),s("div",ae,[e[14]||(e[14]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-envelope"})],-1)),g(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>h.value=r),type:"email",class:"form-control",id:"email",required:"",autocomplete:"username",placeholder:"Nhập email của bạn"},null,512),[[O,h.value]])])]),s("div",oe,[e[17]||(e[17]=s("label",{for:"phone",class:"form-label"},"Số điện thoại",-1)),s("div",le,[e[16]||(e[16]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-phone"})],-1)),g(s("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>d.value=r),type:"tel",class:"form-control",id:"phone",required:"",autocomplete:"tel",placeholder:"0123456789"},null,512),[[O,d.value]])])]),s("div",ne,[e[19]||(e[19]=s("label",{for:"address",class:"form-label"},"Địa chỉ",-1)),s("div",re,[e[18]||(e[18]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-map-marker-alt"})],-1)),g(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>p.value=r),type:"text",class:"form-control",id:"address",autocomplete:"address-line1",placeholder:"Nhập địa chỉ (tùy chọn)"},null,512),[[O,p.value]])])]),s("div",ie,[e[21]||(e[21]=s("label",{for:"password",class:"form-label"},"Mật khẩu",-1)),s("div",ue,[e[20]||(e[20]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-lock"})],-1)),g(s("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>x.value=r),type:S.value?"text":"password",class:"form-control",id:"password",required:"",autocomplete:"new-password",placeholder:"Nhập mật khẩu"},null,8,de),[[I,x.value]]),s("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[5]||(e[5]=r=>S.value=!S.value)},[s("i",{class:c(S.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),s("div",ce,[e[23]||(e[23]=s("label",{for:"confirmPassword",class:"form-label"},"Nhập lại mật khẩu",-1)),s("div",ge,[e[22]||(e[22]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-lock"})],-1)),g(s("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>w.value=r),type:C.value?"text":"password",class:"form-control",id:"confirmPassword",required:"",autocomplete:"new-password",placeholder:"Nhập lại mật khẩu"},null,8,ve),[[I,w.value]]),s("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[7]||(e[7]=r=>C.value=!C.value)},[s("i",{class:c(C.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),s("div",pe,[g(s("input",{type:"checkbox",class:"form-check-input",id:"agreeTerms","onUpdate:modelValue":e[8]||(e[8]=r=>N.value=r),required:""},null,512),[[J,N.value]]),e[24]||(e[24]=s("label",{class:"form-check-label",for:"agreeTerms"},[k(" Tôi đồng ý với "),s("a",{href:"#",class:"text-primary"},"điều khoản sử dụng")],-1))]),s("button",{type:"submit",class:"btn btn-primary w-100 fw-bold",disabled:t.value},[t.value?b("",!0):(f(),m("i",fe)),t.value?(f(),m("span",he)):b("",!0),k(" "+F(t.value?"Đang đăng ký...":"Đăng ký"),1)],8,me)],34),s("div",{class:c(["text-center my-3",{"d-none":t.value}])},e[25]||(e[25]=[s("div",{class:"position-relative"},[s("hr"),s("span",{class:"position-absolute top-50 start-50 translate-middle bg-white px-3 text-muted"},"hoặc")],-1)]),2),s("div",{class:c(["mb-3",{"d-none":t.value}])},[G(z,{"button-text":"Đăng ký với Google",loading:t.value,onGoogleLogin:_},null,8,["loading"])],2),s("div",{class:c(["mb-3",{"d-none":t.value}])},[G(H,{"button-text":"Đăng ký với Facebook",loading:t.value,onFacebookLogin:q},null,8,["loading"])],2),s("div",{class:c(["text-center mt-3",{"d-none":t.value}])},[e[27]||(e[27]=s("span",null,"Đã có tài khoản?",-1)),G(A,{to:"/login",class:"ms-1 text-primary"},{default:j(()=>e[26]||(e[26]=[k("Đăng nhập")])),_:1,__:[26]})],2)])])])}}},we=$(be,[["__scopeId","data-v-ea326c5e"]]);export{we as default};
