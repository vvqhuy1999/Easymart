import{_ as L,x as O,m as j,r,q as f,D as R,h as J,c,a as s,l as M,t as d,f as N,g as m,s as _,Q as A,d as p,w as V,v as Z,b as G,M as S,o as v,A as Q}from"./index-DQ4OBKkW.js";const W={class:"profile-page"},X={class:"container py-5"},Y={class:"row"},ss={class:"col-lg-3 mb-4"},es={class:"card shadow-sm border-0"},ts={class:"card-body text-center"},as={class:"position-relative d-inline-block mb-3"},ls=["src","alt"],os={class:"mb-1"},ns={class:"text-muted mb-0"},is={class:"text-muted"},rs={class:"card shadow-sm border-0 mt-3"},ds={class:"card-body"},us={class:"row text-center"},cs={class:"col-6"},vs={class:"border-end"},ms={class:"text-primary mb-0"},ps={class:"col-6"},hs={class:"text-success mb-0"},fs={class:"mt-2 text-center"},bs={class:"badge bg-info"},gs={class:"col-lg-9"},ys={class:"card shadow-sm border-0"},ws={class:"card-header bg-white border-bottom"},ks={class:"nav nav-tabs card-header-tabs",role:"tablist"},_s={class:"nav-item"},Ps={class:"nav-item"},xs={class:"card-body"},Cs={class:"tab-content"},Ts={key:0,class:"alert alert-success alert-dismissible fade show",role:"alert"},Ns={key:1,class:"alert alert-danger alert-dismissible fade show",role:"alert"},Ds={class:"row"},Ss={class:"col-md-6 mb-3"},$s={class:"input-group"},Ms=["value"],As={class:"col-md-6 mb-3"},Vs={class:"input-group"},Is={class:"col-md-6 mb-3"},Es={class:"input-group"},Us=["value"],qs={class:"col-md-6 mb-3"},zs={class:"input-group"},Bs=["value"],Fs={class:"col-12 mb-3"},Hs={class:"input-group"},Ks=["value"],Ls={class:"d-flex gap-2"},Os=["disabled"],js={key:0,class:"fas fa-save me-2"},Rs={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},Js={class:"tab-content"},Zs={key:0,class:"alert alert-success alert-dismissible fade show",role:"alert",style:{"background-color":"#d4edda !important","border-color":"#c3e6cb !important",color:"#155724 !important"}},Gs={key:1,class:"alert alert-danger alert-dismissible fade show",role:"alert",style:{"background-color":"#f8d7da !important","border-color":"#f5c6cb !important",color:"#721c24 !important"}},Qs={class:"row"},Ws={class:"col-md-6"},Xs={class:"mb-3"},Ys={class:"input-group"},se=["type"],ee={class:"mb-3"},te={class:"input-group"},ae=["type"],le={class:"mb-3"},oe={class:"input-group"},ne=["type"],ie={class:"d-flex gap-2"},re=["disabled"],de={key:0,class:"fas fa-key me-2"},ue={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},ce={__name:"Profile",setup(ve){const D=j(),{user:u,isLoggedIn:I,validateProfileAccess:$,updateCustomerProfile:E}=O(),U=()=>document.cookie.split("; ").find(a=>a.startsWith("easymart-token="))?.split("=")[1];I.value||D.push("/login");const b=r("profile"),l=r({name:"",email:"",phone:"",birthDate:"",address:""}),n=r({currentPassword:"",newPassword:"",confirmPassword:""}),g=r(!1),y=r(!1),P=r(""),w=r(""),k=r(""),i=r(""),x=r(!1),C=r(!1),T=r(!1),o=f(()=>u.value?.customerInfo||{}),q=f(()=>o.value.hoTen||u.value?.name||"User"),z=f(()=>u.value?.email||"No email"),B=f(()=>o.value.ngayTao||u.value?.joinDate);f(()=>o.value.tongDonHang||u.value?.totalOrders||0),f(()=>o.value.tongChiTieu||u.value?.totalSpent||0),f(()=>({formName:l.value.name,customerName:o.value.hoTen,userValue:u.value?.customerInfo?.hoTen,formPhone:l.value.phone,customerPhone:o.value.sdt,formAddress:l.value.address,customerAddress:o.value.diaChi}));const F=a=>{if(!a)return"Ch∆∞a c√≥ th√¥ng tin";try{let e;if(typeof a=="string")e=new Date(a);else if(a instanceof Date)e=a;else return"Ch∆∞a c√≥ th√¥ng tin";return isNaN(e.getTime())?"Ch∆∞a c√≥ th√¥ng tin":e.toLocaleDateString("vi-VN")}catch(e){return console.error("Date formatting error:",e),"Ch∆∞a c√≥ th√¥ng tin"}},H=async()=>{w.value="",P.value="",g.value=!0;try{const a={hoTen:l.value.name,sdt:l.value.phone,ngaySinh:l.value.birthDate,diaChi:l.value.address};console.log("üìù Profile form data:",l.value),console.log("üì§ Update data prepared:",a),console.log("üì± Phone number being sent:",l.value.phone);const e=await E(a);e.success?(P.value=e.message||"Th√¥ng tin c√° nh√¢n ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t th√†nh c√¥ng!",await $()):w.value=e.error||"C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t th√¥ng tin!"}catch(a){console.error("Profile update error:",a),w.value="C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t th√¥ng tin!"}finally{g.value=!1}},K=async()=>{if(i.value="",k.value="",n.value.newPassword!==n.value.confirmPassword){i.value="M·∫≠t kh·∫©u m·ªõi kh√¥ng kh·ªõp!";return}if(n.value.newPassword.length<6){i.value="M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!";return}if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*?&]{6,}$/.test(n.value.newPassword)){i.value="M·∫≠t kh·∫©u ph·∫£i ch·ª©a c·∫£ ch·ªØ v√† s·ªë!";return}if(n.value.newPassword===n.value.currentPassword){i.value="M·∫≠t kh·∫©u m·ªõi kh√¥ng ƒë∆∞·ª£c gi·ªëng m·∫≠t kh·∫©u hi·ªán t·∫°i!";return}y.value=!0;try{const e=U();if(!e){i.value="Kh√¥ng c√≥ token x√°c th·ª±c!";return}const t=await fetch(`${Q.BASE_URL}/api/nguoidung/change-password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({oldPassword:n.value.currentPassword,newPassword:n.value.newPassword,confirmPassword:n.value.confirmPassword})}),h=await t.json();t.ok?h.success||h.message?.includes("th√†nh c√¥ng")||h.message?.includes("success")?(k.value="M·∫≠t kh·∫©u ƒë√£ ƒë∆∞·ª£c thay ƒë·ªïi th√†nh c√¥ng!",n.value.currentPassword="",n.value.newPassword="",n.value.confirmPassword="",x.value=!1,C.value=!1,T.value=!1,setTimeout(()=>{k.value=""},3e3)):i.value=h.message||h.error||"C√≥ l·ªói x·∫£y ra khi thay ƒë·ªïi m·∫≠t kh·∫©u!":i.value=h.message||h.error||`HTTP Error: ${t.status} ${t.statusText}`}catch(e){console.error("Change password error:",e),i.value="C√≥ l·ªói x·∫£y ra khi thay ƒë·ªïi m·∫≠t kh·∫©u!"}finally{y.value=!1}};return R(o,a=>{a&&Object.keys(a).length>0&&(console.log("üëÄ customerInfo changed:",a),l.value={name:a.hoTen||"",email:u.value?.email||"",phone:a.sdt||"",birthDate:a.ngaySinh||"",address:a.diaChi||""},console.log("üîÑ Form auto-updated from customerInfo:",l.value))},{immediate:!0}),J(async()=>{try{console.log("üöÄ Profile page mounted, starting validation...");const a=await $();a.success?(console.log("‚úÖ Profile validated successfully"),console.log("üë§ Current customerInfo:",o.value),o.value&&Object.keys(o.value).length>0?(l.value={name:o.value.hoTen||"",email:u.value?.email||"",phone:o.value.sdt||"",birthDate:o.value.ngaySinh||"",address:o.value.diaChi||""},console.log("üìù Form populated with customer data:",l.value),console.log("üè∑Ô∏è Name field value:",l.value.name),console.log("üì± Phone field value:",l.value.phone),console.log("üìç Address field value:",l.value.address)):console.log("‚ö†Ô∏è customerInfo is empty or undefined")):(console.error("‚ùå Profile validation failed:",a.error),D.push("/login"))}catch(a){console.error("‚ùå Profile initialization error:",a),D.push("/login")}}),(a,e)=>(v(),c("div",W,[s("div",X,[s("div",Y,[s("div",ss,[s("div",es,[s("div",ts,[s("div",as,[s("img",{src:M(u)?.avatar||"https://via.placeholder.com/80",class:"rounded-circle",width:"80",height:"80",alt:M(u)?.name||"User"},null,8,ls),e[17]||(e[17]=s("button",{class:"btn btn-sm btn-primary rounded-circle position-absolute bottom-0 end-0",style:{width:"24px",height:"24px",padding:"0"}},[s("i",{class:"fas fa-camera",style:{"font-size":"0.7rem"}})],-1))]),s("h5",os,d(q.value),1),s("p",ns,d(z.value),1),s("small",is,"Tham gia t·ª´ "+d(F(B.value)),1)])]),s("div",rs,[s("div",ds,[e[20]||(e[20]=s("h6",{class:"card-title"},"Th√¥ng tin kh√°ch h√†ng",-1)),s("div",us,[s("div",cs,[s("div",vs,[s("h6",ms,d(o.value?.maKH||"N/A"),1),e[18]||(e[18]=s("small",{class:"text-muted"},"M√£ KH",-1))])]),s("div",ps,[s("h6",hs,d(o.value?.diemTichLuy||0),1),e[19]||(e[19]=s("small",{class:"text-muted"},"ƒêi·ªÉm t√≠ch l≈©y",-1))])]),s("div",fs,[s("span",bs,d(o.value?.loaiKhachHang||"Th∆∞·ªùng"),1)])])])]),s("div",gs,[s("div",ys,[s("div",ws,[s("ul",ks,[s("li",_s,[s("button",{class:N(["nav-link",{active:b.value==="profile"}]),onClick:e[0]||(e[0]=t=>b.value="profile")},e[21]||(e[21]=[s("i",{class:"fas fa-user me-2"},null,-1),m("Th√¥ng tin c√° nh√¢n ")]),2)]),s("li",Ps,[s("button",{class:N(["nav-link",{active:b.value==="password"}]),onClick:e[1]||(e[1]=t=>b.value="password")},e[22]||(e[22]=[s("i",{class:"fas fa-lock me-2"},null,-1),m("ƒê·ªïi m·∫≠t kh·∫©u ")]),2)])])]),s("div",xs,[_(s("div",Cs,[e[36]||(e[36]=s("h5",{class:"mb-4"},"Th√¥ng tin c√° nh√¢n",-1)),P.value?(v(),c("div",Ts,[e[23]||(e[23]=s("i",{class:"fas fa-check-circle me-2"},null,-1)),m(d(P.value)+" ",1),s("button",{type:"button",class:"btn-close",onClick:e[2]||(e[2]=t=>P.value="")})])):p("",!0),w.value?(v(),c("div",Ns,[e[24]||(e[24]=s("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),m(d(w.value)+" ",1),s("button",{type:"button",class:"btn-close",onClick:e[3]||(e[3]=t=>w.value="")})])):p("",!0),s("form",{onSubmit:V(H,["prevent"])},[s("div",Ds,[s("div",Ss,[e[26]||(e[26]=s("label",{for:"name",class:"form-label"},"H·ªç v√† t√™n *",-1)),s("div",$s,[e[25]||(e[25]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-user"})],-1)),s("input",{value:o.value?.hoTen||l.value.name,onInput:e[4]||(e[4]=t=>l.value.name=t.target.value),type:"text",class:"form-control",id:"name",required:"",placeholder:"Nh·∫≠p h·ªç v√† t√™n"},null,40,Ms)])]),s("div",As,[e[28]||(e[28]=s("label",{for:"email",class:"form-label"},"Email *",-1)),s("div",Vs,[e[27]||(e[27]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-envelope"})],-1)),_(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.email=t),type:"email",class:"form-control",id:"email",required:"",placeholder:"Nh·∫≠p email",disabled:""},null,512),[[Z,l.value.email]])]),e[29]||(e[29]=s("small",{class:"text-muted"},"Email kh√¥ng th·ªÉ thay ƒë·ªïi",-1))]),s("div",Is,[e[31]||(e[31]=s("label",{for:"phone",class:"form-label"},"S·ªë ƒëi·ªán tho·∫°i",-1)),s("div",Es,[e[30]||(e[30]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-phone"})],-1)),s("input",{value:o.value?.sdt||l.value.phone,onInput:e[6]||(e[6]=t=>l.value.phone=t.target.value),type:"tel",class:"form-control",id:"phone",placeholder:"Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"},null,40,Us)])]),s("div",qs,[e[33]||(e[33]=s("label",{for:"birthDate",class:"form-label"},"Ng√†y sinh",-1)),s("div",zs,[e[32]||(e[32]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-calendar"})],-1)),s("input",{value:o.value?.ngaySinh||l.value.birthDate,onInput:e[7]||(e[7]=t=>l.value.birthDate=t.target.value),type:"date",class:"form-control",id:"birthDate"},null,40,Bs)])]),s("div",Fs,[e[35]||(e[35]=s("label",{for:"address",class:"form-label"},"ƒê·ªãa ch·ªâ",-1)),s("div",Hs,[e[34]||(e[34]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-map-marker-alt"})],-1)),s("textarea",{value:o.value?.diaChi||l.value.address,onInput:e[8]||(e[8]=t=>l.value.address=t.target.value),class:"form-control",id:"address",rows:"3",placeholder:"Nh·∫≠p ƒë·ªãa ch·ªâ"},null,40,Ks)])])]),s("div",Ls,[s("button",{type:"submit",class:"btn btn-primary",disabled:g.value},[g.value?p("",!0):(v(),c("i",js)),g.value?(v(),c("span",Rs)):p("",!0),m(" "+d(g.value?"ƒêang c·∫≠p nh·∫≠t...":"C·∫≠p nh·∫≠t th√¥ng tin"),1)],8,Os)])],32)],512),[[A,b.value==="profile"]]),_(s("div",Js,[e[47]||(e[47]=s("h5",{class:"mb-4"},"ƒê·ªïi m·∫≠t kh·∫©u",-1)),k.value?(v(),c("div",Zs,[e[37]||(e[37]=s("i",{class:"fas fa-check-circle me-2"},null,-1)),m(d(k.value)+" ",1),s("button",{type:"button",class:"btn-close",onClick:e[9]||(e[9]=t=>k.value="")})])):p("",!0),i.value?(v(),c("div",Gs,[e[38]||(e[38]=s("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),m(d(i.value)+" ",1),s("button",{type:"button",class:"btn-close",onClick:e[10]||(e[10]=t=>i.value="")})])):p("",!0),s("form",{onSubmit:V(K,["prevent"])},[s("div",Qs,[s("div",Ws,[s("div",Xs,[e[40]||(e[40]=s("label",{for:"currentPassword",class:"form-label"},"M·∫≠t kh·∫©u hi·ªán t·∫°i *",-1)),s("div",Ys,[e[39]||(e[39]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-lock"})],-1)),_(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>n.value.currentPassword=t),type:x.value?"text":"password",class:"form-control",id:"currentPassword",required:"",placeholder:"Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i"},null,8,se),[[S,n.value.currentPassword]]),s("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[12]||(e[12]=t=>x.value=!x.value)},[s("i",{class:N(x.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),s("div",ee,[e[42]||(e[42]=s("label",{for:"newPassword",class:"form-label"},"M·∫≠t kh·∫©u m·ªõi *",-1)),s("div",te,[e[41]||(e[41]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-lock"})],-1)),_(s("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>n.value.newPassword=t),type:C.value?"text":"password",class:"form-control",id:"newPassword",required:"",placeholder:"Nh·∫≠p m·∫≠t kh·∫©u m·ªõi",minlength:"6"},null,8,ae),[[S,n.value.newPassword]]),s("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[14]||(e[14]=t=>C.value=!C.value)},[s("i",{class:N(C.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])]),e[43]||(e[43]=s("div",{class:"form-text"},"M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±",-1))]),s("div",le,[e[45]||(e[45]=s("label",{for:"confirmPassword",class:"form-label"},"X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi *",-1)),s("div",oe,[e[44]||(e[44]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-lock"})],-1)),_(s("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>n.value.confirmPassword=t),type:T.value?"text":"password",class:"form-control",id:"confirmPassword",required:"",placeholder:"Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi"},null,8,ne),[[S,n.value.confirmPassword]]),s("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[16]||(e[16]=t=>T.value=!T.value)},[s("i",{class:N(T.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])])]),e[46]||(e[46]=G('<div class="col-md-6" data-v-8c1c2cd5><div class="card bg-light border-0 h-100" data-v-8c1c2cd5><div class="card-body" data-v-8c1c2cd5><h6 class="card-title" data-v-8c1c2cd5><i class="fas fa-shield-alt text-primary me-2" data-v-8c1c2cd5></i>B·∫£o m·∫≠t m·∫≠t kh·∫©u </h6><ul class="list-unstyled mb-0" data-v-8c1c2cd5><li class="mb-2" data-v-8c1c2cd5><i class="fas fa-check text-success me-2" data-v-8c1c2cd5></i> S·ª≠ d·ª•ng √≠t nh·∫•t 6 k√Ω t·ª± </li><li class="mb-2" data-v-8c1c2cd5><i class="fas fa-check text-success me-2" data-v-8c1c2cd5></i> K·∫øt h·ª£p ch·ªØ v√† s·ªë </li><li class="mb-2" data-v-8c1c2cd5><i class="fas fa-check text-success me-2" data-v-8c1c2cd5></i> Kh√¥ng s·ª≠ d·ª•ng th√¥ng tin c√° nh√¢n </li><li class="mb-0" data-v-8c1c2cd5><i class="fas fa-check text-success me-2" data-v-8c1c2cd5></i> Thay ƒë·ªïi ƒë·ªãnh k·ª≥ </li></ul></div></div></div>',1))]),s("div",ie,[s("button",{type:"submit",class:"btn btn-primary",disabled:y.value},[y.value?p("",!0):(v(),c("i",de)),y.value?(v(),c("span",ue)):p("",!0),m(" "+d(y.value?"ƒêang c·∫≠p nh·∫≠t...":"ƒê·ªïi m·∫≠t kh·∫©u"),1)],8,re)])],32)],512),[[A,b.value==="password"]])])])])])])]))}},he=L(ce,[["__scopeId","data-v-8c1c2cd5"]]);export{he as default};
