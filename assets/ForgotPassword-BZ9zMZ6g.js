import{_ as $,r,c as a,a as s,d as o,g as u,t as v,f as k,w as O,s as T,v as S,M as R,i as A,j,k as D,A as f,m as B,o as n}from"./index-DxWIzZdx.js";const U={class:"d-flex justify-content-center align-items-center",style:{"min-height":"80vh",background:"#f8fafc"}},L={class:"card shadow p-4 border-0",style:{"max-width":"400px",width:"100%","border-radius":"1.5rem"}},q={key:0,class:"text-center mb-3"},K={key:1,class:"alert alert-success",role:"alert"},W={key:2,class:"alert alert-danger",role:"alert"},F={key:3,class:"alert alert-info",role:"alert"},G={class:"mb-3"},I={class:"input-group"},J=["disabled"],z=["disabled"],Q={key:0,class:"fas fa-paper-plane me-2"},X={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},Z={class:"mb-4"},Y={class:"text-muted text-center"},H={class:"mb-3"},ee={class:"input-group"},se=["disabled"],te={class:"d-flex gap-2 mb-3"},le=["disabled"],ae={key:0,class:"fas fa-check me-2"},ne={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},ie=["disabled"],oe={key:0,class:"fas fa-redo me-2"},ue={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},re={class:"mb-4"},de={class:"text-muted text-center"},ce={class:"mb-3"},me={class:"input-group"},ve=["type","disabled"],he={class:"mb-3"},pe={class:"input-group"},fe=["type","disabled"],ge=["disabled"],be={key:0,class:"fas fa-save me-2"},ye={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},ke={class:"text-center mt-3"},_e={__name:"ForgotPassword",setup(xe){const V=B(),d=r(""),h=r(""),p=r(""),b=r(""),_=r(1),l=r(!1),y=r(!1),t=r(""),g=r(""),x=r(""),P=r(!1),w=r(!1);async function E(){if(t.value="",g.value="",x.value="",!d.value){t.value="Vui lòng nhập email";return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.value)){t.value="Email không hợp lệ";return}l.value=!0;try{const e=await fetch(`${f.BASE_URL}${f.PASSWORD_RESET.SEND_OTP}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d.value})}),c=await e.json();e.ok&&c.success?(g.value=`Đã gửi mã OTP đến ${d.value}. Vui lòng kiểm tra email của bạn.`,_.value=2,h.value=""):e.status===404?t.value="Email không tồn tại trong hệ thống":e.status===429?t.value="Bạn đã gửi quá nhiều yêu cầu. Vui lòng đợi 5 phút trước khi thử lại":e.status===500?t.value="Lỗi hệ thống. Vui lòng thử lại sau":t.value=c.message||c.error||"Có lỗi xảy ra, vui lòng thử lại sau"}catch(e){console.error("Send OTP error:",e),t.value="Không thể kết nối đến máy chủ. Vui lòng kiểm tra kết nối mạng và thử lại"}finally{l.value=!1}}async function C(){if(t.value="",!h.value){t.value="Vui lòng nhập mã OTP";return}if(h.value.length!==6){t.value="Mã OTP phải có 6 số";return}l.value=!0;try{const i=await fetch(`${f.BASE_URL}${f.PASSWORD_RESET.VERIFY_OTP}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d.value,otpCode:h.value})}),e=await i.json();i.ok&&e.success?(g.value="Mã OTP hợp lệ! Vui lòng tạo mật khẩu mới.",_.value=3,p.value="",b.value=""):i.status===400?t.value="Mã OTP không đúng hoặc đã hết hạn":i.status===404?t.value="Email không tồn tại trong hệ thống":t.value=e.message||e.error||"Có lỗi xảy ra khi xác thực OTP"}catch(i){console.error("Verify OTP error:",i),t.value="Không thể kết nối đến máy chủ. Vui lòng thử lại sau"}finally{l.value=!1}}async function N(){if(t.value="",!p.value||!b.value){t.value="Vui lòng nhập đầy đủ thông tin";return}if(p.value.length<6){t.value="Mật khẩu phải có ít nhất 6 ký tự";return}if(p.value!==b.value){t.value="Mật khẩu xác nhận không khớp";return}if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*?&]{6,}$/.test(p.value)){t.value="Mật khẩu phải chứa cả chữ và số";return}l.value=!0;try{const e=await fetch(`${f.BASE_URL}${f.PASSWORD_RESET.RESET_PASSWORD}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d.value,otpCode:h.value,newPassword:p.value,confirmPassword:b.value})}),c=await e.json();e.ok&&c.success?(g.value="Đặt lại mật khẩu thành công! Đang chuyển hướng về trang đăng nhập...",setTimeout(()=>{V.push("/login")},3e3)):e.status===400?t.value="Mã OTP không đúng hoặc đã hết hạn":e.status===404?t.value="Email không tồn tại trong hệ thống":t.value=c.message||c.error||"Có lỗi xảy ra khi đặt lại mật khẩu"}catch(e){console.error("Reset password error:",e),t.value="Không thể kết nối đến máy chủ. Vui lòng thử lại sau"}finally{l.value=!1}}async function M(){y.value=!0,t.value="";try{const i=await fetch(`${f.BASE_URL}${f.PASSWORD_RESET.SEND_OTP}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d.value})}),e=await i.json();i.ok&&e.success?(x.value="Đã gửi lại mã OTP mới. Vui lòng kiểm tra email của bạn.",h.value="",setTimeout(()=>{x.value=""},5e3)):i.status===429?t.value="Bạn đã gửi quá nhiều yêu cầu. Vui lòng đợi 5 phút trước khi thử lại":t.value=e.message||e.error||"Có lỗi xảy ra khi gửi lại OTP"}catch(i){console.error("Resend OTP error:",i),t.value="Không thể kết nối đến máy chủ. Vui lòng thử lại sau"}finally{y.value=!1}}return(i,e)=>{const c=D("router-link");return n(),a("div",null,[s("div",U,[s("div",L,[e[25]||(e[25]=s("h2",{class:"mb-4 text-center text-primary fw-bold"},"Quên mật khẩu",-1)),l.value?(n(),a("div",q,e[6]||(e[6]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Đang xử lý...")],-1),s("p",{class:"mt-2 text-muted"},"Đang gửi yêu cầu...",-1)]))):o("",!0),g.value?(n(),a("div",K,[e[7]||(e[7]=s("i",{class:"fas fa-check-circle me-2"},null,-1)),u(v(g.value),1)])):o("",!0),t.value?(n(),a("div",W,[e[8]||(e[8]=s("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),u(v(t.value),1)])):o("",!0),x.value?(n(),a("div",F,[e[9]||(e[9]=s("i",{class:"fas fa-info-circle me-2"},null,-1)),u(v(x.value),1)])):o("",!0),_.value===1&&!g.value?(n(),a("form",{key:4,onSubmit:O(E,["prevent"]),class:k({"d-none":l.value})},[e[12]||(e[12]=s("div",{class:"mb-4"},[s("p",{class:"text-muted text-center"}," Nhập email của bạn để nhận mã OTP đặt lại mật khẩu ")],-1)),s("div",G,[e[11]||(e[11]=s("label",{for:"email",class:"form-label"},"Email",-1)),s("div",I,[e[10]||(e[10]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-envelope"})],-1)),T(s("input",{"onUpdate:modelValue":e[0]||(e[0]=m=>d.value=m),type:"email",class:"form-control",id:"email",required:"",autocomplete:"email",placeholder:"Nhập email của bạn",disabled:l.value},null,8,J),[[S,d.value]])])]),s("button",{type:"submit",class:"btn btn-primary w-100 fw-bold mb-3",disabled:l.value},[l.value?o("",!0):(n(),a("i",Q)),l.value?(n(),a("span",X)):o("",!0),u(" "+v(l.value?"Đang gửi...":"Gửi mã OTP"),1)],8,z)],34)):o("",!0),_.value===2?(n(),a("form",{key:5,onSubmit:O(C,["prevent"]),class:k({"d-none":l.value})},[s("div",Z,[s("p",Y,[e[13]||(e[13]=u(" Nhập mã OTP đã được gửi đến ")),s("strong",null,v(d.value),1)])]),s("div",H,[e[15]||(e[15]=s("label",{for:"otp",class:"form-label"},"Mã OTP",-1)),s("div",ee,[e[14]||(e[14]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-key"})],-1)),T(s("input",{"onUpdate:modelValue":e[1]||(e[1]=m=>h.value=m),type:"text",class:"form-control text-center",id:"otp",required:"",maxlength:"6",placeholder:"Nhập 6 số OTP",disabled:l.value},null,8,se),[[S,h.value]])]),e[16]||(e[16]=s("small",{class:"text-muted"},"Mã OTP có 6 số, hiệu lực trong 5 phút",-1))]),s("div",te,[s("button",{type:"submit",class:"btn btn-primary flex-fill",disabled:l.value},[l.value?o("",!0):(n(),a("i",ae)),l.value?(n(),a("span",ne)):o("",!0),u(" "+v(l.value?"Đang xác thực...":"Xác thực OTP"),1)],8,le),s("button",{type:"button",class:"btn btn-outline-secondary",onClick:M,disabled:y.value},[y.value?o("",!0):(n(),a("i",oe)),y.value?(n(),a("span",ue)):o("",!0),u(" "+v(y.value?"Đang gửi...":"Gửi lại"),1)],8,ie)])],34)):o("",!0),_.value===3?(n(),a("form",{key:6,onSubmit:O(N,["prevent"]),class:k({"d-none":l.value})},[s("div",re,[s("p",de,[e[17]||(e[17]=u(" Tạo mật khẩu mới cho tài khoản ")),s("strong",null,v(d.value),1)])]),s("div",ce,[e[19]||(e[19]=s("label",{for:"newPassword",class:"form-label"},"Mật khẩu mới",-1)),s("div",me,[e[18]||(e[18]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-lock"})],-1)),T(s("input",{"onUpdate:modelValue":e[2]||(e[2]=m=>p.value=m),type:P.value?"text":"password",class:"form-control",id:"newPassword",required:"",minlength:"6",placeholder:"Nhập mật khẩu mới",disabled:l.value},null,8,ve),[[R,p.value]]),s("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[3]||(e[3]=m=>P.value=!P.value)},[s("i",{class:k(P.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])]),e[20]||(e[20]=s("small",{class:"text-muted"},"Mật khẩu phải có ít nhất 6 ký tự",-1))]),s("div",he,[e[22]||(e[22]=s("label",{for:"confirmPassword",class:"form-label"},"Xác nhận mật khẩu",-1)),s("div",pe,[e[21]||(e[21]=s("span",{class:"input-group-text"},[s("i",{class:"fas fa-lock"})],-1)),T(s("input",{"onUpdate:modelValue":e[4]||(e[4]=m=>b.value=m),type:w.value?"text":"password",class:"form-control",id:"confirmPassword",required:"",minlength:"6",placeholder:"Nhập lại mật khẩu mới",disabled:l.value},null,8,fe),[[R,b.value]]),s("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[5]||(e[5]=m=>w.value=!w.value)},[s("i",{class:k(w.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),s("button",{type:"submit",class:"btn btn-primary w-100 fw-bold mb-3",disabled:l.value},[l.value?o("",!0):(n(),a("i",be)),l.value?(n(),a("span",ye)):o("",!0),u(" "+v(l.value?"Đang cập nhật...":"Đặt lại mật khẩu"),1)],8,ge)],34)):o("",!0),s("div",ke,[A(c,{to:"/login",class:"text-muted text-decoration-none"},{default:j(()=>e[23]||(e[23]=[s("i",{class:"fas fa-arrow-left me-1"},null,-1),u("Quay lại đăng nhập ")])),_:1,__:[23]})]),s("div",{class:k(["mt-4 p-3 bg-light rounded",{"d-none":l.value}])},e[24]||(e[24]=[s("h6",{class:"text-muted mb-2"},[s("i",{class:"fas fa-lightbulb me-2"}),u("Lưu ý:")],-1),s("small",{class:"text-muted"},[u(" • Kiểm tra hộp thư email của bạn"),s("br"),u(" • Kiểm tra thư mục spam nếu không thấy"),s("br"),u(" • Mã OTP có hiệu lực trong 5 phút"),s("br"),u(" • Quy trình: Gửi OTP → Xác thực OTP → Đặt lại mật khẩu ")],-1)]),2)])])])}}},we=$(_e,[["__scopeId","data-v-e6d382eb"]]);export{we as default};
