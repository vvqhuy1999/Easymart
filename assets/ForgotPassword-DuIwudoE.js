import{_ as $,r,c as a,a as t,d as o,g as u,t as v,f as k,w as O,v as T,x as S,N as R,k as A,l as B,m as D,B as f,p as j,o as n}from"./index-pi3KkAaC.js";const U={class:"d-flex justify-content-center align-items-center",style:{"min-height":"80vh",background:"#f8fafc"}},L={class:"card shadow p-4 border-0",style:{"max-width":"400px",width:"100%","border-radius":"1.5rem"}},q={key:0,class:"text-center mb-3"},K={key:1,class:"alert alert-success",role:"alert"},W={key:2,class:"alert alert-danger",role:"alert"},F={key:3,class:"alert alert-info",role:"alert"},G={class:"mb-3"},I={class:"input-group"},J=["disabled"],z=["disabled"],Q={key:0,class:"fas fa-paper-plane me-2"},X={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},Z={class:"mb-4"},Y={class:"text-muted text-center"},H={class:"mb-3"},ee={class:"input-group"},te=["disabled"],se={class:"d-flex gap-2 mb-3"},le=["disabled"],ae={key:0,class:"fas fa-check me-2"},ne={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},ie=["disabled"],oe={key:0,class:"fas fa-redo me-2"},ue={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},re={class:"mb-4"},de={class:"text-muted text-center"},ce={class:"mb-3"},me={class:"input-group"},ve=["type","disabled"],he={class:"mb-3"},pe={class:"input-group"},fe=["type","disabled"],ge=["disabled"],be={key:0,class:"fas fa-save me-2"},ye={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},ke={class:"text-center mt-3"},xe={__name:"ForgotPassword",setup(_e){const V=j(),d=r(""),h=r(""),p=r(""),b=r(""),x=r(1),l=r(!1),y=r(!1),s=r(""),g=r(""),_=r(""),P=r(!1),w=r(!1);async function E(){if(s.value="",g.value="",_.value="",!d.value){s.value="Vui lòng nhập email";return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.value)){s.value="Email không hợp lệ";return}l.value=!0;try{const e=await fetch(`${f.BASE_URL}${f.PASSWORD_RESET.SEND_OTP}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d.value})}),c=await e.json();e.ok&&c.success?(g.value=`Đã gửi mã OTP đến ${d.value}. Vui lòng kiểm tra email của bạn.`,x.value=2,h.value=""):e.status===404?s.value="Email không tồn tại trong hệ thống":e.status===429?s.value="Bạn đã gửi quá nhiều yêu cầu. Vui lòng đợi 5 phút trước khi thử lại":e.status===500?s.value="Lỗi hệ thống. Vui lòng thử lại sau":s.value=c.message||c.error||"Có lỗi xảy ra, vui lòng thử lại sau"}catch(e){console.error("Send OTP error:",e),s.value="Không thể kết nối đến máy chủ. Vui lòng kiểm tra kết nối mạng và thử lại"}finally{l.value=!1}}async function C(){if(s.value="",!h.value){s.value="Vui lòng nhập mã OTP";return}if(h.value.length!==6){s.value="Mã OTP phải có 6 số";return}l.value=!0;try{const i=await fetch(`${f.BASE_URL}${f.PASSWORD_RESET.VERIFY_OTP}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d.value,otpCode:h.value})}),e=await i.json();i.ok&&e.success?(g.value="Mã OTP hợp lệ! Vui lòng tạo mật khẩu mới.",x.value=3,p.value="",b.value=""):i.status===400?s.value="Mã OTP không đúng hoặc đã hết hạn":i.status===404?s.value="Email không tồn tại trong hệ thống":s.value=e.message||e.error||"Có lỗi xảy ra khi xác thực OTP"}catch(i){console.error("Verify OTP error:",i),s.value="Không thể kết nối đến máy chủ. Vui lòng thử lại sau"}finally{l.value=!1}}async function N(){if(s.value="",!p.value||!b.value){s.value="Vui lòng nhập đầy đủ thông tin";return}if(p.value.length<6){s.value="Mật khẩu phải có ít nhất 6 ký tự";return}if(p.value!==b.value){s.value="Mật khẩu xác nhận không khớp";return}if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*?&]{6,}$/.test(p.value)){s.value="Mật khẩu phải chứa cả chữ và số";return}l.value=!0;try{const e=await fetch(`${f.BASE_URL}${f.PASSWORD_RESET.RESET_PASSWORD}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d.value,otpCode:h.value,newPassword:p.value,confirmPassword:b.value})}),c=await e.json();e.ok&&c.success?(g.value="Đặt lại mật khẩu thành công! Đang chuyển hướng về trang đăng nhập...",setTimeout(()=>{V.push("/login")},3e3)):e.status===400?s.value="Mã OTP không đúng hoặc đã hết hạn":e.status===404?s.value="Email không tồn tại trong hệ thống":s.value=c.message||c.error||"Có lỗi xảy ra khi đặt lại mật khẩu"}catch(e){console.error("Reset password error:",e),s.value="Không thể kết nối đến máy chủ. Vui lòng thử lại sau"}finally{l.value=!1}}async function M(){y.value=!0,s.value="";try{const i=await fetch(`${f.BASE_URL}${f.PASSWORD_RESET.SEND_OTP}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d.value})}),e=await i.json();i.ok&&e.success?(_.value="Đã gửi lại mã OTP mới. Vui lòng kiểm tra email của bạn.",h.value="",setTimeout(()=>{_.value=""},5e3)):i.status===429?s.value="Bạn đã gửi quá nhiều yêu cầu. Vui lòng đợi 5 phút trước khi thử lại":s.value=e.message||e.error||"Có lỗi xảy ra khi gửi lại OTP"}catch(i){console.error("Resend OTP error:",i),s.value="Không thể kết nối đến máy chủ. Vui lòng thử lại sau"}finally{y.value=!1}}return(i,e)=>{const c=D("router-link");return n(),a("div",null,[t("div",U,[t("div",L,[e[25]||(e[25]=t("h2",{class:"mb-4 text-center text-primary fw-bold"},"Quên mật khẩu",-1)),l.value?(n(),a("div",q,e[6]||(e[6]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Đang xử lý...")],-1),t("p",{class:"mt-2 text-muted"},"Đang gửi yêu cầu...",-1)]))):o("",!0),g.value?(n(),a("div",K,[e[7]||(e[7]=t("i",{class:"fas fa-check-circle me-2"},null,-1)),u(v(g.value),1)])):o("",!0),s.value?(n(),a("div",W,[e[8]||(e[8]=t("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),u(v(s.value),1)])):o("",!0),_.value?(n(),a("div",F,[e[9]||(e[9]=t("i",{class:"fas fa-info-circle me-2"},null,-1)),u(v(_.value),1)])):o("",!0),x.value===1&&!g.value?(n(),a("form",{key:4,onSubmit:O(E,["prevent"]),class:k({"d-none":l.value})},[e[12]||(e[12]=t("div",{class:"mb-4"},[t("p",{class:"text-muted text-center"}," Nhập email của bạn để nhận mã OTP đặt lại mật khẩu ")],-1)),t("div",G,[e[11]||(e[11]=t("label",{for:"email",class:"form-label"},"Email",-1)),t("div",I,[e[10]||(e[10]=t("span",{class:"input-group-text"},[t("i",{class:"fas fa-envelope"})],-1)),T(t("input",{"onUpdate:modelValue":e[0]||(e[0]=m=>d.value=m),type:"email",class:"form-control",id:"email",required:"",autocomplete:"email",placeholder:"Nhập email của bạn",disabled:l.value},null,8,J),[[S,d.value]])])]),t("button",{type:"submit",class:"btn btn-primary w-100 fw-bold mb-3",disabled:l.value},[l.value?o("",!0):(n(),a("i",Q)),l.value?(n(),a("span",X)):o("",!0),u(" "+v(l.value?"Đang gửi...":"Gửi mã OTP"),1)],8,z)],34)):o("",!0),x.value===2?(n(),a("form",{key:5,onSubmit:O(C,["prevent"]),class:k({"d-none":l.value})},[t("div",Z,[t("p",Y,[e[13]||(e[13]=u(" Nhập mã OTP đã được gửi đến ")),t("strong",null,v(d.value),1)])]),t("div",H,[e[15]||(e[15]=t("label",{for:"otp",class:"form-label"},"Mã OTP",-1)),t("div",ee,[e[14]||(e[14]=t("span",{class:"input-group-text"},[t("i",{class:"fas fa-key"})],-1)),T(t("input",{"onUpdate:modelValue":e[1]||(e[1]=m=>h.value=m),type:"text",class:"form-control text-center",id:"otp",required:"",maxlength:"6",placeholder:"Nhập 6 số OTP",disabled:l.value},null,8,te),[[S,h.value]])]),e[16]||(e[16]=t("small",{class:"text-muted"},"Mã OTP có 6 số, hiệu lực trong 5 phút",-1))]),t("div",se,[t("button",{type:"submit",class:"btn btn-primary flex-fill",disabled:l.value},[l.value?o("",!0):(n(),a("i",ae)),l.value?(n(),a("span",ne)):o("",!0),u(" "+v(l.value?"Đang xác thực...":"Xác thực OTP"),1)],8,le),t("button",{type:"button",class:"btn btn-outline-secondary",onClick:M,disabled:y.value},[y.value?o("",!0):(n(),a("i",oe)),y.value?(n(),a("span",ue)):o("",!0),u(" "+v(y.value?"Đang gửi...":"Gửi lại"),1)],8,ie)])],34)):o("",!0),x.value===3?(n(),a("form",{key:6,onSubmit:O(N,["prevent"]),class:k({"d-none":l.value})},[t("div",re,[t("p",de,[e[17]||(e[17]=u(" Tạo mật khẩu mới cho tài khoản ")),t("strong",null,v(d.value),1)])]),t("div",ce,[e[19]||(e[19]=t("label",{for:"newPassword",class:"form-label"},"Mật khẩu mới",-1)),t("div",me,[e[18]||(e[18]=t("span",{class:"input-group-text"},[t("i",{class:"fas fa-lock"})],-1)),T(t("input",{"onUpdate:modelValue":e[2]||(e[2]=m=>p.value=m),type:P.value?"text":"password",class:"form-control",id:"newPassword",required:"",minlength:"6",placeholder:"Nhập mật khẩu mới",disabled:l.value},null,8,ve),[[R,p.value]]),t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[3]||(e[3]=m=>P.value=!P.value)},[t("i",{class:k(P.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])]),e[20]||(e[20]=t("small",{class:"text-muted"},"Mật khẩu phải có ít nhất 6 ký tự",-1))]),t("div",he,[e[22]||(e[22]=t("label",{for:"confirmPassword",class:"form-label"},"Xác nhận mật khẩu",-1)),t("div",pe,[e[21]||(e[21]=t("span",{class:"input-group-text"},[t("i",{class:"fas fa-lock"})],-1)),T(t("input",{"onUpdate:modelValue":e[4]||(e[4]=m=>b.value=m),type:w.value?"text":"password",class:"form-control",id:"confirmPassword",required:"",minlength:"6",placeholder:"Nhập lại mật khẩu mới",disabled:l.value},null,8,fe),[[R,b.value]]),t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[5]||(e[5]=m=>w.value=!w.value)},[t("i",{class:k(w.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),t("button",{type:"submit",class:"btn btn-primary w-100 fw-bold mb-3",disabled:l.value},[l.value?o("",!0):(n(),a("i",be)),l.value?(n(),a("span",ye)):o("",!0),u(" "+v(l.value?"Đang cập nhật...":"Đặt lại mật khẩu"),1)],8,ge)],34)):o("",!0),t("div",ke,[A(c,{to:"/login",class:"text-muted text-decoration-none"},{default:B(()=>e[23]||(e[23]=[t("i",{class:"fas fa-arrow-left me-1"},null,-1),u("Quay lại đăng nhập ")])),_:1,__:[23]})]),t("div",{class:k(["mt-4 p-3 bg-light rounded",{"d-none":l.value}])},e[24]||(e[24]=[t("h6",{class:"text-muted mb-2"},[t("i",{class:"fas fa-lightbulb me-2"}),u("Lưu ý:")],-1),t("small",{class:"text-muted"},[u(" • Kiểm tra hộp thư email của bạn"),t("br"),u(" • Kiểm tra thư mục spam nếu không thấy"),t("br"),u(" • Mã OTP có hiệu lực trong 5 phút"),t("br"),u(" • Quy trình: Gửi OTP → Xác thực OTP → Đặt lại mật khẩu ")],-1)]),2)])])])}}},we=$(xe,[["__scopeId","data-v-e6d382eb"]]);export{we as default};
