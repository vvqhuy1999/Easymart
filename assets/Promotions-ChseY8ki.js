import{_ as N,r as T,c as d,o as l,a as s,b as M,d as h,F as P,e as S,n as G,f as x,t as n,w as L,g as v,u as A,h as X,i as Y,j as H,k as E,l as B,m as V,p as U}from"./index-YAIzo0op.js";const I={class:"coupons-section"},F={class:"container my-5"},j={class:"coupons-grid"},O=["onClick"],Q={class:"coupon-left"},z={class:"coupon-icon"},q={class:"coupon-value"},R={class:"discount-value"},J={class:"discount-unit"},W={class:"coupon-right"},Z={class:"coupon-info"},ss={class:"coupon-title"},ts={class:"coupon-description"},es={class:"coupon-details"},as={class:"coupon-code"},is={class:"code-value"},ns={class:"coupon-expiry"},os={key:0,class:"coupon-condition"},ls={class:"coupon-actions"},ds=["onClick","disabled"],cs={key:0,class:"coupon-status"},rs={key:0,class:"status-badge status-used"},us={key:1,class:"status-badge status-expired"},vs={key:1,class:"popular-badge"},fs={key:0,class:"text-center mt-5"},ms={__name:"CouponsSection",props:{coupons:{type:Array,required:!0},showMoreButton:{type:Boolean,default:!1}},emits:["save-coupon","view-more","coupon-click"],setup(k,{emit:_}){const c=_,u=T(new Set),f=i=>({percentage:"fas fa-percentage",fixed:"fas fa-tag",shipping:"fas fa-shipping-fast",special:"fas fa-star"})[i]||"fas fa-gift",y=i=>i.isUsed?"btn-secondary":i.isExpired?"btn-outline-secondary":u.value.has(i.code)?"btn-success":"btn-primary",w=i=>i.isUsed?"fas fa-check":i.isExpired?"fas fa-times":u.value.has(i.code)?"fas fa-check":"fas fa-copy",D=i=>i.isUsed?"Đã dùng":i.isExpired?"Hết hạn":u.value.has(i.code)?"Đã copy":"Copy mã",p=i=>{const o=new Date(i),t=new Date,e=o.getTime()-t.getTime(),r=Math.ceil(e/(1e3*60*60*24));return r<0?"Đã hết hạn":r===0?"Hết hạn hôm nay":r===1?"Hết hạn ngày mai":r<7?`Còn ${r} ngày`:o.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"})},C=i=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(i),K=async i=>{if(!(i.isUsed||i.isExpired))try{await navigator.clipboard.writeText(i.code),u.value.add(i.code),setTimeout(()=>{u.value.delete(i.code)},3e3),c("save-coupon",i.code)}catch{const t=document.createElement("textarea");t.value=i.code,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),u.value.add(i.code),setTimeout(()=>{u.value.delete(i.code)},3e3),c("save-coupon",i.code)}},$=i=>{c("coupon-click",i)},g=()=>{c("view-more")};return(i,o)=>(l(),d("section",I,[s("div",F,[o[8]||(o[8]=M('<div class="section-header text-center mb-5" data-v-9de26d8f><div class="header-icon" data-v-9de26d8f><i class="fas fa-gift fs-2" data-v-9de26d8f></i></div><h2 class="section-title" data-v-9de26d8f>Mã Khuyến Mãi</h2><p class="section-subtitle" data-v-9de26d8f>Tiết kiệm thêm với các mã giảm giá hấp dẫn</p></div>',1)),s("div",j,[(l(!0),d(P,null,S(k.coupons,(t,e)=>(l(),d("div",{key:t.id,class:"coupon-wrapper",style:G({animationDelay:`${e*.1}s`})},[s("div",{class:x(["coupon-card",[`coupon-${t.type}`,{"coupon-used":t.isUsed,"coupon-expired":t.isExpired}]]),onClick:r=>$(t)},[s("div",Q,[s("div",z,[s("i",{class:x(f(t.type))},null,2)]),s("div",q,[s("div",R,n(t.discount),1),s("div",J,n(t.unit),1)])]),o[6]||(o[6]=M('<div class="coupon-divider" data-v-9de26d8f><div class="divider-line" data-v-9de26d8f></div><div class="divider-circles" data-v-9de26d8f><div class="circle circle-top" data-v-9de26d8f></div><div class="circle circle-bottom" data-v-9de26d8f></div></div></div>',1)),s("div",W,[s("div",Z,[s("h6",ss,n(t.title),1),s("p",ts,n(t.description),1),s("div",es,[s("div",as,[o[0]||(o[0]=s("span",{class:"code-label"},"Mã:",-1)),s("span",is,n(t.code),1)]),s("div",ns,[o[1]||(o[1]=s("i",{class:"fas fa-clock text-warning"},null,-1)),s("span",null,n(p(t.expiry)),1)]),t.minOrder?(l(),d("div",os,[o[2]||(o[2]=s("i",{class:"fas fa-shopping-cart text-info"},null,-1)),s("span",null,"Đơn tối thiểu: "+n(C(t.minOrder)),1)])):h("",!0)])]),s("div",ls,[s("button",{class:x(["btn coupon-btn",y(t)]),onClick:L(r=>K(t),["stop"]),disabled:t.isUsed||t.isExpired},[s("i",{class:x([w(t),"me-2"])},null,2),v(" "+n(D(t)),1)],10,ds)])]),t.isUsed||t.isExpired?(l(),d("div",cs,[t.isUsed?(l(),d("span",rs,o[3]||(o[3]=[s("i",{class:"fas fa-check-circle"},null,-1),v("Đã sử dụng ")]))):t.isExpired?(l(),d("span",us,o[4]||(o[4]=[s("i",{class:"fas fa-times-circle"},null,-1),v("Hết hạn ")]))):h("",!0)])):h("",!0),t.isPopular?(l(),d("div",vs,o[5]||(o[5]=[s("i",{class:"fas fa-fire"},null,-1),s("span",null,"Hot",-1)]))):h("",!0)],10,O)],4))),128))]),k.showMoreButton?(l(),d("div",fs,[s("button",{class:"btn btn-outline-primary btn-lg rounded-pill px-5",onClick:g},o[7]||(o[7]=[s("i",{class:"fas fa-plus me-2"},null,-1),v("Xem thêm mã khuyến mãi ")]))])):h("",!0)])]))}},hs=N(ms,[["__scopeId","data-v-9de26d8f"]]),gs={class:"promotions-page"},ps={class:"page-header"},_s={class:"container"},ys={"aria-label":"breadcrumb",class:"py-3"},bs={class:"breadcrumb mb-0"},xs={class:"breadcrumb-item"},Ts={class:"header-content text-center py-5"},Ms={key:0,class:"promo-stats mb-4"},ks={class:"row g-3 justify-content-center"},ws={class:"col-auto"},Ds={class:"stat-item"},Cs={class:"stat-number"},Ks={class:"col-auto"},$s={class:"stat-item"},Ps={class:"stat-number"},Ss={class:"col-auto"},Es={class:"stat-item"},Bs={class:"stat-number"},Ns={class:"col-auto"},Gs={class:"stat-item"},Ls={class:"stat-number"},As={class:"coupon-preview mt-4"},Xs={class:"d-flex flex-wrap gap-2 justify-content-center"},Ys=["title"],Hs={key:0,class:"text-center py-5"},Vs={key:1,class:"container py-5"},Us={class:"alert alert-warning text-center"},Is={class:"mb-3"},Fs={key:3,class:"promotion-info py-5"},js={class:"container"},Os={class:"row g-4"},Qs={class:"col-md-4"},zs={class:"info-card card-warning"},qs={class:"text-muted"},Rs={class:"col-md-4"},Js={class:"info-card card-success"},Ws={class:"text-muted"},Zs={class:"col-md-4"},st={class:"info-card card-info"},tt={class:"text-muted"},et={class:"row mt-5"},at={class:"col-12"},it={class:"coupon-details-section"},nt={class:"row g-4"},ot={class:"coupon-detail-card"},lt={class:"coupon-header"},dt={class:"coupon-code"},ct={class:"coupon-type"},rt={class:"coupon-body"},ut={class:"coupon-title"},vt={class:"coupon-description"},ft={class:"coupon-value"},mt={key:0},ht={key:1},gt={key:2},pt={key:3},_t={class:"coupon-conditions"},yt={class:"text-muted"},bt={class:"coupon-usage"},xt={class:"progress mb-2",style:{height:"8px"}},Tt={class:"text-muted"},Mt={class:"coupon-dates"},kt={class:"text-muted"},wt={class:"text-center py-4"},Dt={__name:"Promotions",setup(k){U();const{showNotification:_}=A(),c=T([]),u=T(!1),f=T(""),y=async()=>{try{u.value=!0,f.value="",console.log("📡 Fetching promotions from API...");const t=await fetch("http://localhost:8080/api/khuyenmai");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();console.log("📥 Promotions API response:",e);let r=[];if(e?.data)r=e.data;else if(e?.result)r=e.result;else if(Array.isArray(e))r=e;else throw new Error("Unexpected response format");const a=r.filter(b=>b.trangThai===1&&!b.isDeleted);console.log("✅ Active promotions:",a),c.value=a}catch(t){console.error("❌ Error fetching promotions:",t),t.value="Không thể tải danh sách khuyến mãi: "+t.message,_("Có lỗi xảy ra khi tải khuyến mãi!","error")}finally{u.value=!1}},w=X(()=>c.value.map(t=>({id:t.maKM,code:t.couponCode||t.maKM,description:t.moTa,discountType:D(t.loaiKM),discountValue:t.giaTriKM,minOrderValue:0,maxDiscount:t.giaTriKM*1e3,startDate:new Date(t.ngayBatDau),endDate:new Date(t.ngayKetThuc),isActive:p(t),remainingQuantity:t.soLuongToiDa-t.daSuDung,totalQuantity:t.soLuongToiDa,usedQuantity:t.daSuDung,conditions:t.dieuKienApDung,programName:t.tenChuongTrinh}))),D=t=>({PhanTram:"percentage",TienMat:"fixed",Diem:"points",MuaXTangY:"buyXGetY",GiamGia:"discount"})[t]||"discount",p=t=>{const e=new Date,r=new Date(t.ngayBatDau),a=new Date(t.ngayKetThuc);return e>=r&&e<=a&&t.trangThai===1&&!t.isDeleted&&t.daSuDung<t.soLuongToiDa},C=()=>{console.log("Loading more coupons...")},K=t=>{console.log("Saving coupon:",t);const r=c.value.find(a=>a.maKM===t.id)?.couponCode||t.code;_(`Đã lưu mã khuyến mãi ${r}!`,"success")},$=()=>{const t=c.value.filter(e=>e.loaiKM==="PhanTram");return t.length===0?0:Math.max(...t.map(e=>e.giaTriKM))},g=()=>{const t=c.value.length,e=c.value.filter(m=>p(m)).length,r=c.value.filter(m=>m.loaiKM==="PhanTram").length,a=c.value.filter(m=>m.loaiKM==="MuaXTangY").length,b=c.value.filter(m=>m.loaiKM==="Diem").length;return{total:t,active:e,percentage:r,buyXGetY:a,points:b}},i=t=>new Date(t).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}),o=t=>({PhanTram:"Giảm giá",TienMat:"Tiền mặt",Diem:"Điểm",MuaXTangY:"Mua X tặng Y",GiamGia:"Giảm giá"})[t]||"Khuyến mãi";return Y(async()=>{document.title="Khuyến mãi Bùng Nổ - EasyMart",await y()}),(t,e)=>{const r=V("router-link");return l(),d("div",gs,[s("div",ps,[s("div",_s,[s("nav",ys,[s("ol",bs,[s("li",xs,[E(r,{to:"/",class:"text-decoration-none"},{default:B(()=>e[0]||(e[0]=[s("i",{class:"fas fa-home me-1"},null,-1),v("Trang chủ ")])),_:1,__:[0]})]),e[1]||(e[1]=s("li",{class:"breadcrumb-item active","aria-current":"page"},[s("i",{class:"fas fa-gift me-1"}),v("Khuyến mãi ")],-1))])]),s("div",Ts,[e[7]||(e[7]=M('<div class="header-icon" data-v-bad6c412><i class="fas fa-gift fs-1" data-v-bad6c412></i></div><h1 class="display-4 fw-bold mb-3" data-v-bad6c412>🎉 KHUYẾN MÃI BÙ<span class="text-warning" data-v-bad6c412>NG NỔ</span> 🎉</h1><p class="lead mb-4" data-v-bad6c412>💥 Ưu đãi khủng - Giá sốc - Tiết kiệm tối đa 💥</p>',3)),!u.value&&!f.value&&c.value.length>0?(l(),d("div",Ms,[s("div",ks,[s("div",ws,[s("div",Ds,[s("span",Cs,n(g().total),1),e[2]||(e[2]=s("span",{class:"stat-label"},"Tổng khuyến mãi",-1))])]),s("div",Ks,[s("div",$s,[s("span",Ps,n(g().active),1),e[3]||(e[3]=s("span",{class:"stat-label"},"Đang diễn ra",-1))])]),s("div",Ss,[s("div",Es,[s("span",Bs,n(g().percentage),1),e[4]||(e[4]=s("span",{class:"stat-label"},"Giảm %",-1))])]),s("div",Ns,[s("div",Gs,[s("span",Ls,n(g().buyXGetY),1),e[5]||(e[5]=s("span",{class:"stat-label"},"Mua X tặng Y",-1))])])]),s("div",As,[e[6]||(e[6]=s("h6",{class:"text-white mb-3"},[s("i",{class:"fas fa-ticket-alt me-2"}),v(" Mã khuyến mãi có sẵn: ")],-1)),s("div",Xs,[(l(!0),d(P,null,S(c.value.filter(a=>a.couponCode),a=>(l(),d("span",{key:a.maKM,class:"coupon-badge",title:`${a.tenChuongTrinh} - ${a.moTa}`},n(a.couponCode),9,Ys))),128))])])])):h("",!0),e[8]||(e[8]=s("div",{class:"promo-badges"},[s("span",{class:"badge-flash"},"⚡ FLASH SALE"),s("span",{class:"badge-hot"},"🔥 HOT DEAL"),s("span",{class:"badge-new"},"✨ MỚI NHẤT")],-1))])])]),u.value?(l(),d("div",Hs,e[9]||(e[9]=[s("div",{class:"spinner-border text-warning",role:"status",style:{width:"3rem",height:"3rem"}},[s("span",{class:"visually-hidden"},"Đang tải...")],-1),s("p",{class:"mt-3 text-white fs-5"},"Đang tải khuyến mãi...",-1)]))):f.value?(l(),d("div",Vs,[s("div",Us,[e[11]||(e[11]=s("i",{class:"fas fa-exclamation-triangle fa-2x mb-3"},null,-1)),e[12]||(e[12]=s("h5",null,"Không thể tải khuyến mãi",-1)),s("p",Is,n(f.value),1),s("button",{onClick:y,class:"btn btn-warning"},e[10]||(e[10]=[s("i",{class:"fas fa-redo me-2"},null,-1),v("Thử lại ")]))])])):(l(),H(hs,{key:2,coupons:w.value,showMoreButton:!0,onSaveCoupon:K,onViewMore:C},null,8,["coupons"])),!u.value&&!f.value&&c.value.length>0?(l(),d("section",Fs,[s("div",js,[s("div",Os,[s("div",Qs,[s("div",zs,[e[13]||(e[13]=s("div",{class:"info-icon"},[s("i",{class:"fas fa-clock"})],-1)),e[14]||(e[14]=s("h5",null,"⏰ Ưu Đãi Có Hạn",-1)),s("p",qs,n(c.value.filter(a=>p(a)).length)+" khuyến mãi đang diễn ra! Hãy sử dụng ngay trước khi hết hạn. ",1),e[15]||(e[15]=s("div",{class:"card-shine"},null,-1))])]),s("div",Rs,[s("div",Js,[e[16]||(e[16]=s("div",{class:"info-icon"},[s("i",{class:"fas fa-percentage"})],-1)),s("h5",null,"💰 Giảm Giá Lên Đến "+n($())+"%",1),s("p",Ws," Tiết kiệm đáng kể với "+n(c.value.filter(a=>a.loaiKM==="PhanTram").length)+" mã giảm giá theo phần trăm! ",1),e[17]||(e[17]=s("div",{class:"card-shine"},null,-1))])]),s("div",Zs,[s("div",st,[e[18]||(e[18]=s("div",{class:"info-icon"},[s("i",{class:"fas fa-gift"})],-1)),e[19]||(e[19]=s("h5",null,"🎁 Khuyến Mãi Đặc Biệt",-1)),s("p",tt,n(c.value.filter(a=>a.loaiKM==="MuaXTangY").length)+" chương trình mua X tặng Y đang chờ bạn! ",1),e[20]||(e[20]=s("div",{class:"card-shine"},null,-1))])])]),s("div",et,[s("div",at,[s("div",it,[e[22]||(e[22]=s("h3",{class:"text-center mb-4"},[s("i",{class:"fas fa-tags text-primary me-2"}),v(" Chi Tiết Mã Khuyến Mãi ")],-1)),s("div",nt,[(l(!0),d(P,null,S(c.value.filter(a=>a.couponCode),a=>(l(),d("div",{key:a.maKM,class:"col-lg-4 col-md-6"},[s("div",ot,[s("div",lt,[s("div",dt,n(a.couponCode),1),s("div",ct,n(o(a.loaiKM)),1)]),s("div",rt,[s("h6",ut,n(a.tenChuongTrinh),1),s("p",vt,n(a.moTa),1),s("div",ft,[a.loaiKM==="PhanTram"?(l(),d("span",mt," Giảm "+n(a.giaTriKM)+"% ",1)):a.loaiKM==="Diem"?(l(),d("span",ht," Tặng "+n(a.giaTriKM)+" điểm ",1)):a.loaiKM==="MuaXTangY"?(l(),d("span",gt," Mua X tặng Y ")):(l(),d("span",pt," Giá trị: "+n(a.giaTriKM),1))]),s("div",_t,[s("small",yt,n(a.dieuKienApDung),1)]),s("div",bt,[s("div",xt,[s("div",{class:"progress-bar bg-success",style:G({width:`${a.daSuDung/a.soLuongToiDa*100}%`})},null,4)]),s("small",Tt," Đã sử dụng: "+n(a.daSuDung)+"/"+n(a.soLuongToiDa),1)]),s("div",Mt,[s("small",kt,[e[21]||(e[21]=s("i",{class:"fas fa-calendar me-1"},null,-1)),v(" "+n(i(a.ngayBatDau))+" - "+n(i(a.ngayKetThuc)),1)])])])])]))),128))])])])])])])):h("",!0),s("div",wt,[E(r,{to:"/",class:"btn btn-explosive btn-lg rounded-pill px-5"},{default:B(()=>e[23]||(e[23]=[s("i",{class:"fas fa-arrow-left me-2"},null,-1),v("🛒 Tiếp tục mua sắm ngay! ")])),_:1,__:[23]})]),e[24]||(e[24]=M('<div class="floating-elements" data-v-bad6c412><div class="float-element float-1" data-v-bad6c412>💥</div><div class="float-element float-2" data-v-bad6c412>🎁</div><div class="float-element float-3" data-v-bad6c412>⭐</div><div class="float-element float-4" data-v-bad6c412>🔥</div><div class="float-element float-5" data-v-bad6c412>💎</div></div>',1))])}}},Kt=N(Dt,[["__scopeId","data-v-bad6c412"]]);export{Kt as default};
