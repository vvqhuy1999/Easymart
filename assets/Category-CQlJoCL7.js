import{_ as G,u as N,r as y,q as b,y as B,h as D,A as M,c as o,a as e,i as c,d as R,j as f,k as L,g as d,f as x,t as v,F,e as H,G as O,H as _,I as p,m as j,o as n,l as C,P as U}from"./index-jpswdiZ0.js";const W={class:"category-page"},K={class:"container py-5 mt-5"},Y={"aria-label":"breadcrumb",class:"mb-4"},q={class:"breadcrumb"},z={class:"breadcrumb-item"},J={class:"breadcrumb-item active","aria-current":"page"},Q={key:0,class:"category-header mb-5 text-center"},X={class:"category-icon mb-3"},Z={class:"category-title"},aa={class:"text-muted"},sa={key:1,class:"text-center py-5"},ea={key:2,class:"text-center py-5"},ta={class:"error-state"},oa={key:3,class:"row g-4"},na={key:4,class:"text-center py-5"},ia={class:"no-products"},ra={__name:"Category",setup(la){const A=j(),T=B(),{formatPrice:k,addToCart:I,getCategoryById:S,showNotification:P}=N(),i=y([]),m=y(!1),u=y(!1),r=b(()=>T.params.id),l=b(()=>S(r.value)),g=async()=>{if(r.value)try{m.value=!0,u.value=!1;const t=await fetch(`${_}${p.PRODUCTS.BY_CATEGORY_ACTIVE(r.value)}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();console.log("[Category] API raw length:",Array.isArray(s)?s.length:-1),i.value=s.map(a=>({id:a.maSP||a.id,name:a.tenSP||a.name,price:a.giaHienTai||a.giaBan||a.price,originalPrice:a.giaGoc||a.originalPrice,categoryId:a.loaiSanPham?.maLoaiSP||a.categoryId,categoryName:a.loaiSanPham?.tenLoai||a.categoryName,image:`${_}${p.IMAGES.SERVE_IMAGE(a.maSP+"_main.jfif")}`,images:p.IMAGES.PRODUCT_IMAGES(a.maSP).map($=>`${_}${$}`),description:a.moTa||a.description,isFlashSale:a.isFlashSale||!1,isActive:a.isActive!==!1,stock:a.trongLuong||a.stock||0,unit:a.donViTinh||a.unit||"cái",rating:a.danhGia||a.rating||4.5,reviews:a.danhGia||a.reviews||[]})),console.log("[Category] Mapped products:",i.value.map(a=>({id:a.id,price:a.price,giaHienTai:a.giaHienTai})))}catch(t){console.error(`Failed to load products for category ${r.value}:`,t),u.value=!0,i.value=[]}finally{m.value=!1}},w=t=>{A.push({name:"ProductDetail",params:{id:t}})},E=t=>{P("Đã thêm vào danh sách yêu thích!","success")},V=t=>{P(`Đã copy mã khuyến mãi: ${t}`,"success")};return D(()=>{g()}),M(r,()=>{g()}),(t,s)=>{const a=L("router-link");return n(),o("div",W,[e("div",K,[e("nav",Y,[e("ol",q,[e("li",z,[c(a,{to:"/",class:"text-decoration-none"},{default:f(()=>s[0]||(s[0]=[e("i",{class:"fas fa-home"},null,-1),d(" Trang chủ ")])),_:1,__:[0]})]),e("li",J,[e("i",{class:x(l.value?.icon)},null,2),d(" "+v(l.value?.name||"Danh mục"),1)])])]),l.value?(n(),o("div",Q,[e("div",X,[e("i",{class:x(`${l.value.icon} fa-4x text-primary`)},null,2)]),e("h1",Z,v(l.value.name),1),e("p",aa,"Khám phá "+v(i.value.length)+" sản phẩm chất lượng",1)])):R("",!0),m.value?(n(),o("div",sa,s[1]||(s[1]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Đang tải sản phẩm...")],-1),e("p",{class:"text-muted mt-3"},"Đang tải sản phẩm trong danh mục...",-1)]))):u.value?(n(),o("div",ea,[e("div",ta,[s[4]||(s[4]=e("i",{class:"fas fa-exclamation-triangle fa-4x text-danger mb-4"},null,-1)),s[5]||(s[5]=e("h3",{class:"text-danger mb-3"},"Không thể tải sản phẩm",-1)),s[6]||(s[6]=e("p",{class:"text-muted mb-4"},"Đã xảy ra lỗi khi tải sản phẩm từ API",-1)),e("button",{onClick:g,class:"btn btn-primary me-2"},s[2]||(s[2]=[e("i",{class:"fas fa-refresh me-2"},null,-1),d("Thử lại ")])),c(a,{to:"/",class:"btn btn-outline-secondary"},{default:f(()=>s[3]||(s[3]=[e("i",{class:"fas fa-arrow-left me-2"},null,-1),d("Về trang chủ ")])),_:1,__:[3]})])])):i.value.length>0?(n(),o("div",oa,[(n(!0),o(F,null,H(i.value,h=>(n(),o("div",{key:h.id,class:"col-6 col-md-4 col-lg-3"},[c(U,{product:h,formatPrice:C(k),onAddToCart:C(I),onViewDetail:w,onAddToWishlist:E},null,8,["product","formatPrice","onAddToCart"])]))),128))])):(n(),o("div",na,[e("div",ia,[s[8]||(s[8]=e("i",{class:"fas fa-box-open fa-4x text-muted mb-4"},null,-1)),s[9]||(s[9]=e("h3",{class:"text-muted mb-3"},"Chưa có sản phẩm",-1)),s[10]||(s[10]=e("p",{class:"text-muted mb-4"},"Danh mục này hiện chưa có sản phẩm nào",-1)),c(a,{to:"/",class:"btn btn-primary"},{default:f(()=>s[7]||(s[7]=[e("i",{class:"fas fa-arrow-left me-2"},null,-1),d(" Về trang chủ ")])),_:1,__:[7]})])]))]),c(O,{"show-on-scroll":!0,"scroll-threshold":200,onCouponCopied:V})])}}},da=G(ra,[["__scopeId","data-v-596ffc19"]]);export{da as default};
