import{_ as _e,u as ke,q as Pe,r as _,h as C,i as Te,p as xe,c as r,a as t,d as y,k as U,l as O,m as we,g as d,t as u,w as Ne,s as I,v as H,f as M,x,y as Ie,F as Z,e as Q,z as ie,A as E,B as Se,o as c}from"./index-B2tEJJdM.js";const Ve={class:"checkout-page"},De={class:"container py-5 mt-5"},Ce={"aria-label":"breadcrumb",class:"mb-4"},Me={class:"breadcrumb"},Ae={class:"breadcrumb-item"},He={key:0,class:"breadcrumb-item"},Ee={key:1,class:"breadcrumb-item"},Ue={class:"d-flex justify-content-between align-items-center mb-4"},Oe={class:"mb-0"},$e={key:0,class:"row"},Le={class:"col-lg-8"},je={class:"card mb-4"},Fe={class:"card-body"},Re={class:"row"},Ge={class:"col-md-6 mb-3"},Be={key:0,class:"invalid-feedback"},qe={class:"col-md-6 mb-3"},Ke={key:0,class:"invalid-feedback"},Je={class:"mb-3"},ze={key:0,class:"invalid-feedback"},We={class:"mb-3"},Ze={key:0,class:"invalid-feedback"},Qe={class:"mb-3"},Ye={key:0,class:"mb-3"},Xe={class:"d-flex gap-2"},et={class:"card mb-4"},tt={class:"card-body"},nt={key:0,class:"text-center py-4"},ot={key:1,class:"row"},at={class:"form-check payment-method"},st=["id","value"],lt=["for"],it={class:"d-flex align-items-center"},rt={class:"text-muted small"},ct={key:0,class:"text-info small"},ut={key:2,class:"alert alert-warning"},dt={key:3,class:"row"},ht={class:"col-md-6 mb-3"},mt={class:"form-check payment-method"},gt={key:4,class:"payment-info mt-3 p-3 bg-light rounded"},pt={class:"text-primary mb-3"},ft={class:"row"},vt={class:"col-md-6"},yt={class:"mb-2"},bt={class:"mb-2"},_t={key:0,class:"mb-2"},kt={class:"col-md-6"},Pt={class:"mb-0 text-info"},Tt={key:0,class:"banking-details mt-3 p-3 bg-white rounded border"},xt={class:"row"},wt={class:"col-md-6"},Nt={class:"mb-1"},It={class:"col-lg-4"},St={class:"card sticky-top",style:{top:"100px"}},Vt={class:"card-body"},Dt={class:"order-items mb-3"},Ct=["src","alt"],Mt={class:"flex-grow-1"},At={class:"mb-1"},Ht={class:"d-flex justify-content-between"},Et={class:"text-muted"},Ut={class:"fw-bold"},Ot={class:"order-summary"},$t={class:"d-flex justify-content-between mb-2"},Lt={key:0,class:"d-flex justify-content-between mb-2"},jt={class:"text-info"},Ft={class:"coupon-section mb-3"},Rt={class:"d-flex gap-2 mb-2"},Gt=["disabled"],Bt=["disabled"],qt={key:0},Kt={key:1},Jt={key:0,class:"applied-coupon"},zt={class:"d-flex justify-content-between align-items-center p-3 rounded-3",style:{background:"linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1))",border:"1px solid rgba(102, 126, 234, 0.3)"}},Wt={class:"fw-bold",style:{color:"#667eea"}},Zt={class:"small text-muted"},Qt={key:1,class:"d-flex justify-content-between mb-2",style:{color:"#11998e"}},Yt={key:2,class:"available-coupons mt-2"},Xt={class:"d-flex flex-wrap gap-1"},en=["onClick","title"],tn={class:"d-flex justify-content-between mb-3"},nn={class:"text-danger fs-5"},on=["disabled"],an={key:0},sn={key:1},ln={key:2},rn={key:1,class:"row"},cn={class:"col-12"},un={class:"empty-checkout text-center py-5"},dn={class:"text-muted mb-4"},hn={__name:"Checkout",setup(mn){const R=xe(),{formatPrice:P,showNotification:h,products:Y}=ke(),{cart:X,clearCart:re}=Pe(),{user:m,isLoggedIn:w}=Ie(),ee=()=>{console.log("üîç Debug LocalStorage Data:"),console.log("   - easymart-invoice:",localStorage.getItem("easymart-invoice")),console.log("   - easymart-selected-items:",localStorage.getItem("easymart-selected-items")),console.log("   - easymart-cart:",localStorage.getItem("easymart-cart"));try{const o=JSON.parse(localStorage.getItem("easymart-invoice")||"null");o&&(console.log("   - Invoice parsed:",o),console.log("   - Invoice keys:",Object.keys(o)),console.log("   - chiTietHoaDon:",o.chiTietHoaDon),console.log("   - items:",o.items))}catch(o){console.error("   - Error parsing invoice:",o)}},$=o=>{if(!o)return"/placeholder-image.jpg";const e=Se.IMAGES.PRODUCT_IMAGES(o);return e[0]?`${E.BASE_URL}${e[0]}`:"/placeholder-image.jpg"},te=()=>{console.log("üîê Checking auth status..."),console.log("   - isLoggedIn:",w),console.log("   - user:",m),console.log("   - orderForm:",s),w&&typeof w.value<"u"?console.log("‚úÖ isLoggedIn is properly initialized"):console.log("‚ùå isLoggedIn is not properly initialized"),m&&typeof m.value<"u"?console.log("‚úÖ user is properly initialized"):console.log("‚ùå user is not properly initialized")},ne=async()=>{try{if(!w||!w.value){console.log("‚ö†Ô∏è User ch∆∞a ƒëƒÉng nh·∫≠p ho·∫∑c isLoggedIn undefined"),G();return}if(!m||!m.value){console.log("‚ö†Ô∏è User object ch∆∞a s·∫µn s√†ng ho·∫∑c user undefined"),G();return}if(console.log("üë§ Pre-filling user info:",m.value),await ce(),m.value.name&&(s.value.fullName=m.value.name),m.value.email&&(s.value.email=m.value.email),m.value.customerInfo){const o=m.value.customerInfo;o.hoTen&&(s.value.fullName=o.hoTen),o.sdt&&(s.value.phone=o.sdt),o.diaChi&&(s.value.address=o.diaChi),o.nguoiDung?.email&&(s.value.email=o.nguoiDung.email)}console.log("‚úÖ Form ƒë√£ ƒë∆∞·ª£c pre-fill:",s.value)}catch(o){console.error("‚ùå L·ªói khi pre-fill user info:",o),console.log("üîç Debug info:",{isLoggedIn:w,user:m,orderForm:s}),G()}},G=()=>{try{console.log("üîÑ Trying fallback: getting user info from localStorage...");const o=localStorage.getItem("easymart-user");if(o){const e=JSON.parse(o);console.log("üì¶ Found user data in localStorage:",e),e.name&&(s.value.fullName=e.name),e.email&&(s.value.email=e.email),console.log("‚úÖ Fallback pre-fill successful")}else console.log("‚ö†Ô∏è No user data found in localStorage")}catch(o){console.error("‚ùå Fallback also failed:",o)}},ce=async()=>{try{console.log("üì° Fetching shipping info from Profile API..."),ae.value=!0;const o=m.value?.customerInfo?.maKH;if(!o){console.log("‚ö†Ô∏è No maKH found, cannot fetch shipping info");return}const e=B();if(!e){console.log("‚ö†Ô∏è No token found, cannot fetch shipping info");return}const i=`${E.BASE_URL}/api/khachhang/${o}/info`;console.log("üîó Fetching from endpoint:",i);const n=await fetch(i,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!n.ok){console.log("‚ö†Ô∏è Profile API failed:",n.status);return}const a=await n.json();console.log("üì• Profile API response:",a);let l=null;a?.data?l=a.data:a?.result?l=a.result:a?.hoTen||a?.sdt||a?.diaChi?l=a:Array.isArray(a)&&(l=a[0]),l&&(console.log("‚úÖ Customer data received:",l),m.value?.customerInfo&&(m.value.customerInfo={...m.value.customerInfo,...l}),l.hoTen&&(s.value.fullName=l.hoTen),l.sdt&&(s.value.phone=l.sdt),l.diaChi&&(s.value.address=l.diaChi),l.nguoiDung?.email&&(s.value.email=l.nguoiDung.email),console.log("‚úÖ Shipping info updated from Profile API"))}catch(o){console.error("‚ùå Error fetching shipping info:",o)}finally{ae.value=!1}},ue=async()=>{try{console.log("üì§ Updating shipping info to Profile API...");const o=m.value?.customerInfo?.maKH;if(!o)return console.log("‚ö†Ô∏è No maKH found, cannot update shipping info"),!1;const e=B();if(!e)return console.log("‚ö†Ô∏è No token found, cannot update shipping info"),!1;const i={hoTen:s.value.fullName,sdt:s.value.phone,diaChi:s.value.address,email:s.value.email};console.log("üì§ Update data prepared:",i);const n=`${E.BASE_URL}/api/khachhang/${o}/update-info`;console.log("üîó Update endpoint:",n);const a=await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(i)});if(!a.ok){const v=await a.json().catch(()=>({}));return console.log("‚ö†Ô∏è Update failed:",a.status,v.message),!1}const l=await a.json();return console.log("üì• Update response:",l),l?.success||l?.result?.success||l?.message?.includes("th√†nh c√¥ng")?(console.log("‚úÖ Shipping info updated successfully"),m.value?.customerInfo&&(m.value.customerInfo={...m.value.customerInfo,hoTen:s.value.fullName,sdt:s.value.phone,diaChi:s.value.address}),!0):(console.log("‚ö†Ô∏è Update response format unexpected:",l),!1)}catch(o){return console.error("‚ùå Error updating shipping info:",o),!1}},B=()=>document.cookie.split("; ").find(o=>o.startsWith("easymart-token="))?.split("=")[1],oe=async()=>{try{console.log("üì° Fetching payment methods from API..."),K.value=!0,J.value="";const o=await fetch(`${E.BASE_URL}/api/phuongthucthanhtoan`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const e=await o.json();console.log("üì• Payment methods API response:",e);let i=[];if(e?.data)i=e.data;else if(e?.result)i=e.result;else if(Array.isArray(e))i=e;else throw new Error("Unexpected response format");const n=i.filter(a=>a.trangThai===1&&!a.isDeleted);console.log("‚úÖ Active payment methods:",n),j.value=n,n.length>0&&!s.value.paymentMethod&&(s.value.paymentMethod=n[0].tenPTTT)}catch(o){console.error("‚ùå Error fetching payment methods:",o),J.value="Kh√¥ng th·ªÉ t·∫£i ph∆∞∆°ng th·ª©c thanh to√°n: "+o.message}finally{K.value=!1}},de=o=>({"Ti·ªÅn M·∫∑t":"fas fa-hand-holding-usd text-success","Chuy·ªÉn Kho·∫£n":"fas fa-university text-primary",MoMo:"fab fa-momo text-danger",ZaloPay:"fas fa-mobile-alt text-warning","Th·∫ª T√≠n D·ª•ng":"fas fa-credit-card text-info",VNPay:"fas fa-credit-card text-info"})[o]||"fas fa-credit-card text-secondary",he=o=>({"Ti·ªÅn M·∫∑t":"B·∫°n s·∫Ω thanh to√°n b·∫±ng ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng.","Chuy·ªÉn Kho·∫£n":"Vui l√≤ng chuy·ªÉn kho·∫£n theo th√¥ng tin ng√¢n h√†ng b√™n d∆∞·ªõi.",MoMo:"B·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn app MoMo ƒë·ªÉ ho√†n t·∫•t thanh to√°n.",ZaloPay:"B·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn app ZaloPay ƒë·ªÉ ho√†n t·∫•t thanh to√°n.","Th·∫ª T√≠n D·ª•ng":"B·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn c·ªïng thanh to√°n ƒë·ªÉ nh·∫≠p th√¥ng tin th·∫ª.",VNPay:"B·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn c·ªïng thanh to√°n VNPay ƒë·ªÉ ho√†n t·∫•t giao d·ªãch."})[o]||"Vui l√≤ng l√†m theo h∆∞·ªõng d·∫´n thanh to√°n.",L=_(!1),q=_(!1),f=_(""),p=_({}),ae=_(!1),j=_([]),K=_(!1),J=_(""),S=_(""),g=_(null),F=_(!1),z=_([{code:"WELCOME10",description:"Gi·∫£m 10% cho ƒë∆°n h√†ng ƒë·∫ßu ti√™n",discountType:"percentage",discountValue:10,minOrderValue:1e5,maxDiscount:5e4},{code:"SAVE50K",description:"Gi·∫£m 50.000ƒë cho ƒë∆°n t·ª´ 500.000ƒë",discountType:"fixed",discountValue:5e4,minOrderValue:5e5,maxDiscount:5e4},{code:"VIP20",description:"Gi·∫£m 20% cho kh√°ch VIP (t·ªëi ƒëa 100k)",discountType:"percentage",discountValue:20,minOrderValue:2e5,maxDiscount:1e5}]),s=_({fullName:"",phone:"",email:"",address:"",notes:"",paymentMethod:"cod"}),b=_([]),A=C(()=>b.value.reduce((o,e)=>o+(e.product?.price||0)*e.quantity,0)),V=C(()=>{if(!g.value)return 0;const o=g.value,e=A.value;if(e<o.minOrderValue)return 0;let i=0;switch(o.discountType){case"percentage":i=e*o.discountValue/100;break;case"fixed":i=o.discountValue;break;case"shipping":i=0;break;default:i=0}return Math.min(i,o.maxDiscount)}),N=C(()=>{const o=k.value?.phiGiaoDich||0;return A.value-V.value+o}),W=C(()=>b.value.reduce((o,e)=>o+e.quantity,0)),me=C(()=>s.value.fullName&&s.value.phone&&s.value.address&&s.value.paymentMethod),k=C(()=>j.value.find(o=>o.tenpttt===s.value.paymentMethod)),T=C(()=>b.value.length===1&&!1),ge=()=>{const o=Date.now().toString().slice(-6),e=Math.random().toString(36).substr(2,4).toUpperCase();return`EM${o}${e}`},pe=()=>(p.value={},s.value.fullName.trim()||(p.value.fullName="Vui l√≤ng nh·∫≠p h·ªç v√† t√™n"),s.value.phone.trim()?/^[0-9]{10,11}$/.test(s.value.phone.replace(/\s/g,""))||(p.value.phone="S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá"):p.value.phone="Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i",s.value.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.value.email)&&(p.value.email="Email kh√¥ng h·ª£p l·ªá"),s.value.address.trim()||(p.value.address="Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng"),Object.keys(p.value).length===0),se=async()=>{if(S.value.trim()){F.value=!0;try{await new Promise(e=>setTimeout(e,1e3));const o=z.value.find(e=>e.code.toLowerCase()===S.value.trim().toLowerCase());if(!o){h("M√£ khuy·∫øn m√£i kh√¥ng h·ª£p l·ªá!","error");return}if(A.value<o.minOrderValue){h(`ƒê∆°n h√†ng t·ªëi thi·ªÉu ${P(o.minOrderValue)} ƒë·ªÉ √°p d·ª•ng m√£ n√†y!`,"warning");return}g.value=o,h(`√Åp d·ª•ng m√£ ${o.code} th√†nh c√¥ng!`,"success")}catch{h("C√≥ l·ªói x·∫£y ra khi √°p d·ª•ng m√£ khuy·∫øn m√£i!","error")}finally{F.value=!1}}},fe=()=>{g.value=null,S.value="",h("ƒê√£ x√≥a m√£ khuy·∫øn m√£i!","info")},ve=o=>{S.value=o,se()},le=async()=>{if(!pe()){h("Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin ƒë∆°n h√†ng","error");return}L.value=!0;try{w&&w.value&&m.value?.customerInfo?.maKH&&(console.log("üîÑ Auto-updating shipping info to Profile..."),await ue()?h("Th√¥ng tin giao h√†ng ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t v√†o Profile!","success"):console.log("‚ö†Ô∏è Failed to update shipping info to Profile, continuing with order..."));const o=localStorage.getItem("easymart-invoice");let e;if(o){const i=JSON.parse(o);console.log("üìã C·∫≠p nh·∫≠t th√¥ng tin giao h√†ng cho h√≥a ƒë∆°n:",i.maHD),await new Promise(n=>setTimeout(n,1e3)),e={orderCode:`HD${i.maHD}`,invoiceId:i.maHD,customer:{...s.value},items:b.value,summary:{subtotal:A.value,couponDiscount:V.value,total:N.value,itemsCount:W.value},coupon:g.value?{code:g.value.code,description:g.value.description,discountType:g.value.discountType,discountValue:V.value}:null,createdAt:i.ngayLap||new Date().toISOString()}}else console.log("‚ö†Ô∏è Kh√¥ng c√≥ h√≥a ƒë∆°n, t·∫°o ƒë∆°n h√†ng m·ªõi"),await new Promise(i=>setTimeout(i,2e3)),e={orderCode:f.value,customer:{...s.value},items:b.value,summary:{subtotal:A.value,couponDiscount:V.value,total:N.value,itemsCount:W.value},coupon:g.value?{code:g.value.code,description:g.value.description,discountType:g.value.discountType,discountValue:V.value}:null,createdAt:new Date().toISOString()};console.log("üßπ Clearing cart after successful checkout...");try{await re(),console.log("‚úÖ Backend cart cleared successfully")}catch(i){console.warn("‚ö†Ô∏è Failed to clear backend cart:",i)}localStorage.removeItem("easymart-selected-items"),console.log("üßπ localStorage cleared"),await ye(e)}catch{h("C√≥ l·ªói x·∫£y ra khi ƒë·∫∑t h√†ng. Vui l√≤ng th·ª≠ l·∫°i!","error")}finally{L.value=!1}},ye=async o=>{const e=s.value.paymentMethod;switch(localStorage.setItem("easymart-last-order",JSON.stringify(o)),e){case"Ti·ªÅn M·∫∑t":h(`ƒê·∫∑t h√†ng th√†nh c√¥ng! M√£ ƒë∆°n h√†ng: ${f.value}. B·∫°n s·∫Ω thanh to√°n khi nh·∫≠n h√†ng.`,"success");break;case"Chuy·ªÉn Kho·∫£n":h(`ƒê·∫∑t h√†ng th√†nh c√¥ng! M√£ ƒë∆°n h√†ng: ${f.value}. Vui l√≤ng chuy·ªÉn kho·∫£n theo th√¥ng tin ƒë√£ cung c·∫•p.`,"success");break;case"MoMo":h("ƒêang chuy·ªÉn ƒë·∫øn MoMo ƒë·ªÉ thanh to√°n...","info"),setTimeout(()=>{h(`Thanh to√°n MoMo th√†nh c√¥ng! M√£ ƒë∆°n h√†ng: ${f.value}`,"success")},1500);break;case"ZaloPay":h("ƒêang chuy·ªÉn ƒë·∫øn ZaloPay ƒë·ªÉ thanh to√°n...","info"),setTimeout(()=>{h(`Thanh to√°n ZaloPay th√†nh c√¥ng! M√£ ƒë∆°n h√†ng: ${f.value}`,"success")},1500);break;case"Th·∫ª T√≠n D·ª•ng":h("ƒêang chuy·ªÉn ƒë·∫øn c·ªïng thanh to√°n...","info"),setTimeout(()=>{h(`Thanh to√°n th·∫ª t√≠n d·ª•ng th√†nh c√¥ng! M√£ ƒë∆°n h√†ng: ${f.value}`,"success")},1500);break;case"VNPay":try{q.value=!0,h("ƒêang chuy·ªÉn ƒë·∫øn VNPay ƒë·ªÉ thanh to√°n...","info");const i=B();if(!i){h("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ thanh to√°n qua VNPay!","error");return}const n={vnp_OrderInfo:`Thanh to√°n ƒë∆°n h√†ng ${f.value}`,ordertype:"other",amount:Math.round(N.value).toString(),maHD:f.value.replace(/^(HD|EM)/,""),language:"vn",txt_billing_mobile:"0905123456",txt_billing_email:"nguyenvana@example.com",txt_billing_fullname:"Nguyen Van A",txt_inv_addr1:"123 Duong So 1, Quan 1, TP.HCM"};if(Object.keys(n).forEach(D=>{(n[D]===void 0||n[D]===null)&&(n[D]="")}),console.log("üí≥ Amount conversion:",{original:N.value,converted:n.amount,originalType:typeof N.value,convertedType:typeof n.amount}),console.log("üìã API Format Comparison:",{expected:{amount:"100000",amountType:"string"},actual:{amount:n.amount,amountType:typeof n.amount},match:typeof n.amount=="string"}),console.log("üìã Form Data vs Default Template:",{template:{txt_billing_mobile:"0905123456",txt_billing_email:"nguyenvana@example.com",txt_billing_fullname:"Nguyen Van A",txt_inv_addr1:"123 Duong So 1, Quan 1, TP.HCM"},actual:{txt_billing_mobile:n.txt_billing_mobile,txt_billing_email:n.txt_billing_email,txt_billing_fullname:n.txt_billing_fullname,txt_inv_addr1:n.txt_inv_addr1},note:"Using default values as per API template"}),console.log("üîç Pre-validation check:",{txt_billing_mobile:n.txt_billing_mobile,txt_billing_fullname:n.txt_billing_fullname,txt_inv_addr1:n.txt_inv_addr1,amount:n.amount,maHD:n.maHD,maHDType:typeof n.maHD,maHDLength:n.maHD?n.maHD.length:"N/A"}),console.log("üîç Validating txt_billing_mobile:",n.txt_billing_mobile,"Result:",!!n.txt_billing_mobile),!n.txt_billing_mobile||!n.txt_billing_fullname||!n.txt_inv_addr1)throw new Error("Th√¥ng tin giao h√†ng kh√¥ng ƒë·∫ßy ƒë·ªß ƒë·ªÉ thanh to√°n VNPay");if(console.log("üîç Validating amount:",n.amount,"Result:",!!(n.amount&&Number(n.amount)>0)),!n.amount||Number(n.amount)<=0)throw new Error("S·ªë ti·ªÅn thanh to√°n kh√¥ng h·ª£p l·ªá");if(console.log("üîç Validating maHD:",n.maHD,"Result:",!!(n.maHD&&n.maHD!=="NEW")),!n.maHD||n.maHD==="NEW")throw new Error("M√£ h√≥a ƒë∆°n kh√¥ng h·ª£p l·ªá. Vui l√≤ng th·ª≠ l·∫°i!");console.log("üí≥ VNPay payment data:",n),console.log("üí≥ Original orderCode:",f.value),console.log("üí≥ Extracted maHD:",n.maHD),console.log("üí≥ Amount type:",typeof n.amount,"Value:",n.amount),console.log("üí≥ VNPay API endpoint:",`${E.BASE_URL}/api/thanhtoan/vnpay`),console.log("üí≥ VNPay token:",i?"Present":"Missing"),console.log("üí≥ Request body:",JSON.stringify(n,null,2));const a=await fetch(`${E.BASE_URL}/api/thanhtoan/vnpay`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(n)});if(!a.ok){const D=await a.json().catch(()=>({})),be=D.message||D.error||"Unknown error";throw console.error("‚ùå VNPay API error response:",D),new Error(`VNPay API error: ${a.status} - ${be}`)}const l=await a.json();console.log("üí≥ VNPay API response:",l),console.log("üí≥ VNPay response keys:",Object.keys(l)),console.log("üí≥ VNPay response data:",l.data),console.log("üí≥ VNPay response type:",typeof l),console.log("üí≥ VNPay data type:",typeof l.data),console.log("üí≥ VNPay data starts with http:",l.data&&typeof l.data=="string"?l.data.startsWith("http"):"N/A");let v=null;if(l?.data&&typeof l.data=="string"&&l.data.startsWith("http")?v=l.data:l?.data?.paymentUrl?v=l.data.paymentUrl:l?.paymentUrl?v=l.paymentUrl:l?.url?v=l.url:l?.vnp_PayUrl?v=l.vnp_PayUrl:l?.redirectUrl?v=l.redirectUrl:typeof l=="string"&&l.startsWith("http")&&(v=l),console.log("üí≥ Extracted payment URL:",v),v)console.log("üîÑ Redirecting to VNPay:",v),h("Chuy·ªÉn h∆∞·ªõng ƒë·∫øn VNPay...","success"),setTimeout(()=>{window.location.href=v},1e3);else throw new Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c URL thanh to√°n t·ª´ VNPay API")}catch(i){console.error("‚ùå VNPay payment error:",i),h(`L·ªói thanh to√°n VNPay: ${i.message}`,"error"),setTimeout(()=>{h(`Thanh to√°n VNPay th√†nh c√¥ng! M√£ ƒë∆°n h√†ng: ${f.value}`,"success"),R.push({name:"PaymentSuccess",query:{orderCode:f.value,total:N.value,paymentMethod:e}})},2e3)}finally{q.value=!1}return;default:h(`ƒê·∫∑t h√†ng th√†nh c√¥ng! M√£ ƒë∆°n h√†ng: ${f.value}`,"success")}e!=="VNPay"&&setTimeout(()=>{R.push({name:"PaymentSuccess",query:{orderCode:f.value,total:N.value,paymentMethod:e}})},3e3)};return Te(async()=>{console.log("üöÄ Checkout page mounted"),await oe(),ee();const o=localStorage.getItem("easymart-invoice"),e=localStorage.getItem("easymart-selected-items");if(o&&e){const i=JSON.parse(o),n=JSON.parse(e);console.log("üìã Nh·∫≠n h√≥a ƒë∆°n:",i),console.log("üõí Selected items:",n),console.log("üîç Invoice structure:",Object.keys(i)),f.value=`HD${i.maHD||i.orderId||"NEW"}`,i.chiTietHoaDon&&i.chiTietHoaDon.length>0?(console.log("‚úÖ S·ª≠ d·ª•ng chiTietHoaDon t·ª´ Orders.vue"),b.value=i.chiTietHoaDon.map(a=>({productId:a.maSP||a.productId,quantity:a.soLuong||a.quantity,product:{id:a.maSP||a.productId,name:a.tenSP||a.productName,price:a.donGiaBan||a.donGia||a.productPrice,image:$(a.maSP||a.productId)}}))):i.items&&i.items.length>0?(console.log("‚úÖ S·ª≠ d·ª•ng items t·ª´ Cart.vue/ProductDetail"),b.value=i.items.map(a=>({productId:a.maSP||a.productId,quantity:a.soLuong||a.quantity,product:{id:a.maSP||a.productId,name:a.tenSP||a.productName,price:a.donGiaBan||a.donGia||a.productPrice,image:$(a.maSP||a.productId)}}))):(console.log("‚ö†Ô∏è Kh√¥ng c√≥ items trong h√≥a ƒë∆°n, th·ª≠ fallback..."),b.value=X.value.filter(a=>n.includes(a.productId)).map(a=>{const l=Y.value.find(v=>v.id===a.productId);return l&&(l.image=$(a.productId)),{...a,product:l}}).filter(a=>a.product)),te(),await ne()}else{if(f.value=ge(),e){const i=JSON.parse(e);b.value=X.value.filter(n=>i.includes(n.productId)).map(n=>{const a=Y.value.find(l=>l.id===n.productId);return a&&(a.image=$(n.productId)),{...n,product:a}}).filter(n=>n.product)}te(),await ne()}console.log("üìä Final selectedItems state:"),console.log("   - Length:",b.value.length),console.log("   - Items:",b.value),console.log("   - Invoice data:",o?JSON.parse(o):"None"),console.log("   - Stored selected items:",e),b.value.length===0?(console.warn("‚ö†Ô∏è No selected items found, redirecting to cart..."),h("Vui l√≤ng ch·ªçn s·∫£n ph·∫©m t·ª´ gi·ªè h√†ng ƒë·ªÉ thanh to√°n","warning"),setTimeout(()=>{R.push("/cart")},2e3)):console.log("‚úÖ Selected items loaded successfully, staying on checkout page")}),(o,e)=>{const i=we("router-link");return c(),r("div",Ve,[t("div",De,[t("nav",Ce,[t("ol",Me,[t("li",Ae,[U(i,{to:"/",class:"text-decoration-none"},{default:O(()=>e[8]||(e[8]=[t("i",{class:"fas fa-home"},null,-1),d(" Trang ch·ªß ")])),_:1,__:[8]})]),T.value?y("",!0):(c(),r("li",He,[U(i,{to:"/cart",class:"text-decoration-none"},{default:O(()=>e[9]||(e[9]=[t("i",{class:"fas fa-shopping-cart"},null,-1),d(" Gi·ªè h√†ng ")])),_:1,__:[9]})])),T.value?(c(),r("li",Ee,e[10]||(e[10]=[t("span",{class:"text-muted"},[t("i",{class:"fas fa-bolt"}),d(" Mua ngay ")],-1)]))):y("",!0),e[11]||(e[11]=t("li",{class:"breadcrumb-item active","aria-current":"page"},[t("i",{class:"fas fa-credit-card"}),d(" Thanh to√°n ")],-1))])]),t("div",Ue,[t("h2",Oe,[e[12]||(e[12]=t("i",{class:"fas fa-credit-card text-primary me-2"},null,-1)),d(" "+u(T.value?"Thanh to√°n mua ngay":"Thanh to√°n ƒë∆°n h√†ng"),1)]),t("div",{class:"d-flex gap-2"},[t("button",{onClick:ee,class:"btn btn-outline-warning btn-sm",title:"Debug localStorage data"},e[13]||(e[13]=[t("i",{class:"fas fa-bug me-1"},null,-1),d("Debug Data ")]))])]),b.value.length>0?(c(),r("div",$e,[t("div",Le,[t("div",je,[e[21]||(e[21]=t("div",{class:"card-header bg-primary text-white"},[t("h5",{class:"mb-0"},[t("i",{class:"fas fa-truck me-2"}),d(" Th√¥ng tin giao h√†ng ")])],-1)),t("div",Fe,[t("form",{onSubmit:Ne(le,["prevent"])},[t("div",Re,[t("div",Ge,[e[14]||(e[14]=t("label",{for:"fullName",class:"form-label"},"H·ªç v√† t√™n *",-1)),I(t("input",{type:"text",class:M(["form-control",{"is-invalid":p.value.fullName}]),id:"fullName","onUpdate:modelValue":e[0]||(e[0]=n=>s.value.fullName=n),required:""},null,2),[[H,s.value.fullName]]),p.value.fullName?(c(),r("div",Be,u(p.value.fullName),1)):y("",!0)]),t("div",qe,[e[15]||(e[15]=t("label",{for:"phone",class:"form-label"},"S·ªë ƒëi·ªán tho·∫°i *",-1)),I(t("input",{type:"tel",class:M(["form-control",{"is-invalid":p.value.phone}]),id:"phone","onUpdate:modelValue":e[1]||(e[1]=n=>s.value.phone=n),required:""},null,2),[[H,s.value.phone]]),p.value.phone?(c(),r("div",Ke,u(p.value.phone),1)):y("",!0)])]),t("div",Je,[e[16]||(e[16]=t("label",{for:"email",class:"form-label"},"Email",-1)),I(t("input",{type:"email",class:M(["form-control",{"is-invalid":p.value.email}]),id:"email","onUpdate:modelValue":e[2]||(e[2]=n=>s.value.email=n)},null,2),[[H,s.value.email]]),p.value.email?(c(),r("div",ze,u(p.value.email),1)):y("",!0)]),t("div",We,[e[17]||(e[17]=t("label",{for:"address",class:"form-label"},"ƒê·ªãa ch·ªâ giao h√†ng *",-1)),I(t("textarea",{class:M(["form-control",{"is-invalid":p.value.address}]),id:"address",rows:"3","onUpdate:modelValue":e[3]||(e[3]=n=>s.value.address=n),placeholder:"S·ªë nh√†, t√™n ƒë∆∞·ªùng, ph∆∞·ªùng/x√£, qu·∫≠n/huy·ªán, t·ªânh/th√†nh ph·ªë",required:""},null,2),[[H,s.value.address]]),p.value.address?(c(),r("div",Ze,u(p.value.address),1)):y("",!0)]),t("div",Qe,[e[18]||(e[18]=t("label",{for:"notes",class:"form-label"},"Ghi ch√∫ ƒë∆°n h√†ng",-1)),I(t("textarea",{class:"form-control",id:"notes",rows:"2","onUpdate:modelValue":e[4]||(e[4]=n=>s.value.notes=n),placeholder:"Ghi ch√∫ v·ªÅ ƒë∆°n h√†ng, v√≠ d·ª•: th·ªùi gian hay ch·ªâ d·∫´n ƒë·ªãa ƒëi·ªÉm giao h√†ng chi ti·∫øt h∆°n."},null,512),[[H,s.value.notes]])]),x(w)?(c(),r("div",Ye,[t("div",Xe,[U(i,{to:"/profile",class:"btn btn-outline-info btn-sm",title:"Chuy·ªÉn ƒë·∫øn trang Profile ƒë·ªÉ c·∫≠p nh·∫≠t th√¥ng tin"},{default:O(()=>e[19]||(e[19]=[t("i",{class:"fas fa-user-edit me-2"},null,-1),d(" C·∫≠p nh·∫≠t th√¥ng tin t·ª´ Profile ")])),_:1,__:[19]})]),e[20]||(e[20]=t("div",{class:"mt-2"},[t("small",{class:"text-muted"},[t("i",{class:"fas fa-info-circle me-1"}),d(" Th√¥ng tin giao h√†ng s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c ƒë·ªìng b·ªô v·ªõi Profile khi ƒë·∫∑t h√†ng ")])],-1))])):y("",!0)],32)])]),t("div",et,[e[36]||(e[36]=t("div",{class:"card-header bg-success text-white"},[t("h5",{class:"mb-0"},[t("i",{class:"fas fa-money-bill-wave me-2"}),d(" Ph∆∞∆°ng th·ª©c thanh to√°n ")])],-1)),t("div",tt,[K.value?(c(),r("div",nt,e[22]||(e[22]=[t("div",{class:"spinner-border text-success",role:"status"},[t("span",{class:"visually-hidden"},"ƒêang t·∫£i...")],-1),t("p",{class:"mt-2 text-muted"},"ƒêang t·∫£i ph∆∞∆°ng th·ª©c thanh to√°n...",-1)]))):j.value.length>0?(c(),r("div",ot,[(c(!0),r(Z,null,Q(j.value,n=>(c(),r("div",{key:n.maPTTT,class:"col-md-6 mb-3"},[t("div",at,[I(t("input",{class:"form-check-input",type:"radio",name:"paymentMethod",id:n.maPTTT,value:n.tenPTTT,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.paymentMethod=a)},null,8,st),[[ie,s.value.paymentMethod]]),t("label",{class:"form-check-label w-100",for:n.maPTTT},[t("div",it,[t("i",{class:M([de(n.tenPTTT),"me-3 fs-4"])},null,2),t("div",null,[t("strong",null,u(n.tenPTTT),1),t("div",rt,u(n.moTa),1),n.phiGiaoDich>0?(c(),r("div",ct," Ph√≠ giao d·ªãch: "+u(x(P)(n.phiGiaoDich)),1)):y("",!0)])])],8,lt)])]))),128))])):J.value?(c(),r("div",ut,[e[24]||(e[24]=t("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),e[25]||(e[25]=d(" Kh√¥ng th·ªÉ t·∫£i ph∆∞∆°ng th·ª©c thanh to√°n. Vui l√≤ng th·ª≠ l·∫°i sau. ")),t("button",{onClick:oe,class:"btn btn-sm btn-outline-warning ms-2"},e[23]||(e[23]=[t("i",{class:"fas fa-redo me-1"},null,-1),d("Th·ª≠ l·∫°i ")]))])):(c(),r("div",dt,[t("div",ht,[t("div",mt,[I(t("input",{class:"form-check-input",type:"radio",name:"paymentMethod",id:"cod",value:"cod","onUpdate:modelValue":e[6]||(e[6]=n=>s.value.paymentMethod=n)},null,512),[[ie,s.value.paymentMethod]]),e[26]||(e[26]=t("label",{class:"form-check-label w-100",for:"cod"},[t("div",{class:"d-flex align-items-center"},[t("i",{class:"fas fa-hand-holding-usd text-success me-3 fs-4"}),t("div",null,[t("strong",null,"Thanh to√°n khi nh·∫≠n h√†ng (COD)"),t("div",{class:"text-muted small"},"Thanh to√°n b·∫±ng ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng")])])],-1))])])])),s.value.paymentMethod&&k.value?(c(),r("div",gt,[t("h6",pt,[e[27]||(e[27]=t("i",{class:"fas fa-info-circle me-2"},null,-1)),d(" Th√¥ng tin "+u(k.value.tenPTTT),1)]),t("div",ft,[t("div",vt,[t("p",yt,[e[28]||(e[28]=t("strong",null,"S·ªë ti·ªÅn:",-1)),d(" "+u(x(P)(N.value)),1)]),t("p",bt,[e[29]||(e[29]=t("strong",null,"M√£ ƒë∆°n h√†ng:",-1)),d(" "+u(f.value),1)]),k.value.phiGiaoDich>0?(c(),r("p",_t,[e[30]||(e[30]=t("strong",null,"Ph√≠ giao d·ªãch:",-1)),d(" "+u(x(P)(k.value.phiGiaoDich)),1)])):y("",!0)]),t("div",kt,[t("p",Pt,[t("small",null,[e[31]||(e[31]=t("strong",null,"H∆∞·ªõng d·∫´n:",-1)),d(" "+u(he(k.value.tenPTTT)),1)])])])]),k.value.tenPTTT==="Chuy·ªÉn Kho·∫£n"?(c(),r("div",Tt,[e[35]||(e[35]=t("h6",{class:"text-primary mb-2"},"Th√¥ng tin chuy·ªÉn kho·∫£n",-1)),t("div",xt,[e[34]||(e[34]=t("div",{class:"col-md-6"},[t("p",{class:"mb-1"},[t("strong",null,"Ng√¢n h√†ng:"),d(" Vietcombank")]),t("p",{class:"mb-1"},[t("strong",null,"S·ªë t√†i kho·∫£n:"),d(" 1234567890")]),t("p",{class:"mb-1"},[t("strong",null,"Ch·ªß t√†i kho·∫£n:"),d(" EASYMART COMPANY")])],-1)),t("div",wt,[t("p",Nt,[e[32]||(e[32]=t("strong",null,"N·ªôi dung:",-1)),d(" THANHTOAN "+u(f.value),1)]),e[33]||(e[33]=t("p",{class:"mb-0 text-danger"},[t("small",null,[t("strong",null,"L∆∞u √Ω:"),d(" Vui l√≤ng chuy·ªÉn kho·∫£n ƒë√∫ng n·ªôi dung ƒë·ªÉ ƒë∆°n h√†ng ƒë∆∞·ª£c x·ª≠ l√Ω nhanh ch√≥ng.")])],-1))])])])):y("",!0)])):y("",!0)])])]),t("div",It,[t("div",St,[e[46]||(e[46]=t("div",{class:"card-header bg-warning text-dark"},[t("h5",{class:"mb-0"},[t("i",{class:"fas fa-receipt me-2"}),d(" ƒê∆°n h√†ng c·ªßa b·∫°n ")])],-1)),t("div",Vt,[t("div",Dt,[(c(!0),r(Z,null,Q(b.value,n=>(c(),r("div",{key:n.productId,class:"order-item d-flex align-items-center mb-3 pb-3 border-bottom"},[t("img",{src:n.product?.image,alt:n.product?.name,class:"order-item-image me-3"},null,8,Ct),t("div",Mt,[t("h6",At,u(n.product?.name),1),t("div",Ht,[t("span",Et,u(x(P)(n.product?.price||0))+" x "+u(n.quantity),1),t("span",Ut,u(x(P)((n.product?.price||0)*n.quantity)),1)])])]))),128))]),t("div",Ot,[t("div",$t,[t("span",null,"T·∫°m t√≠nh ("+u(W.value)+" s·∫£n ph·∫©m):",1),t("span",null,u(x(P)(A.value)),1)]),k.value&&k.value.phiGiaoDich>0?(c(),r("div",Lt,[t("span",null,"Ph√≠ giao d·ªãch ("+u(k.value.tenPTTT)+"):",1),t("span",jt,u(x(P)(k.value.phiGiaoDich)),1)])):y("",!0),t("div",Ft,[t("div",Rt,[I(t("input",{type:"text",class:"form-control form-control-sm",placeholder:"Nh·∫≠p m√£ khuy·∫øn m√£i","onUpdate:modelValue":e[7]||(e[7]=n=>S.value=n),disabled:g.value},null,8,Gt),[[H,S.value]]),t("button",{class:"btn btn-outline-primary btn-sm",onClick:se,disabled:!S.value.trim()||g.value||F.value},[F.value?(c(),r("span",qt,e[37]||(e[37]=[t("i",{class:"fas fa-spinner fa-spin"},null,-1)]))):(c(),r("span",Kt,u(g.value?"ƒê√£ √°p d·ª•ng":"√Åp d·ª•ng"),1))],8,Bt)]),g.value?(c(),r("div",Jt,[t("div",zt,[t("div",null,[t("small",Wt,[e[38]||(e[38]=t("i",{class:"fas fa-ticket-alt me-1"},null,-1)),d(" "+u(g.value.code),1)]),t("div",Zt,u(g.value.description),1)]),t("button",{class:"btn btn-sm",style:{background:"linear-gradient(135deg, #ff6b6b, #ee5a5a)",color:"white",border:"none"},onClick:fe,title:"X√≥a m√£ khuy·∫øn m√£i"},e[39]||(e[39]=[t("i",{class:"fas fa-times"},null,-1)]))])])):y("",!0),V.value>0?(c(),r("div",Qt,[t("span",null,"Gi·∫£m gi√° ("+u(g.value?.code)+"):",1),t("span",null,"-"+u(x(P)(V.value)),1)])):y("",!0),!g.value&&z.value.length>0?(c(),r("div",Yt,[e[40]||(e[40]=t("small",{class:"text-muted d-block mb-2"},"M√£ khuy·∫øn m√£i c√≥ s·∫µn:",-1)),t("div",Xt,[(c(!0),r(Z,null,Q(z.value,n=>(c(),r("button",{key:n.code,class:"btn btn-sm",style:{background:"linear-gradient(135deg, #667eea, #764ba2)",color:"white",border:"none"},onClick:a=>ve(n.code),title:n.description},u(n.code),9,en))),128))])])):y("",!0)]),e[45]||(e[45]=t("hr",null,null,-1)),t("div",tn,[e[41]||(e[41]=t("strong",{class:"fs-5"},"T·ªïng c·ªông:",-1)),t("strong",nn,u(x(P)(N.value)),1)]),t("button",{type:"button",class:"btn btn-primary w-100 mb-2 py-2",onClick:le,disabled:L.value||!me.value},[L.value?(c(),r("span",an,e[42]||(e[42]=[t("i",{class:"fas fa-spinner fa-spin me-2"},null,-1),d(" ƒêang x·ª≠ l√Ω... ")]))):q.value?(c(),r("span",sn,e[43]||(e[43]=[t("i",{class:"fas fa-spinner fa-spin me-2"},null,-1),d(" ƒêang chuy·ªÉn ƒë·∫øn VNPay... ")]))):(c(),r("span",ln,e[44]||(e[44]=[t("i",{class:"fas fa-check me-2"},null,-1),d(" ƒê·∫∑t h√†ng ")])))],8,on),U(i,{to:T.value?"/":"/cart",class:"btn btn-outline-secondary w-100"},{default:O(()=>[t("i",{class:M([T.value?"fas fa-home":"fas fa-arrow-left","me-2"])},null,2),d(" "+u(T.value?"V·ªÅ trang ch·ªß":"Quay l·∫°i gi·ªè h√†ng"),1)]),_:1},8,["to"])])])])])])):(c(),r("div",rn,[t("div",cn,[t("div",un,[e[47]||(e[47]=t("div",{class:"empty-checkout-icon mb-4"},[t("i",{class:"fas fa-exclamation-triangle fa-5x text-warning"})],-1)),e[48]||(e[48]=t("h3",{class:"text-muted mb-3"},"Kh√¥ng c√≥ s·∫£n ph·∫©m ƒë·ªÉ thanh to√°n",-1)),t("p",dn,u(T.value?"Vui l√≤ng quay l·∫°i trang s·∫£n ph·∫©m ƒë·ªÉ mua h√†ng":"Vui l√≤ng quay l·∫°i gi·ªè h√†ng v√† ch·ªçn s·∫£n ph·∫©m ƒë·ªÉ thanh to√°n"),1),U(i,{to:T.value?"/":"/cart",class:"btn btn-primary btn-lg"},{default:O(()=>[t("i",{class:M([T.value?"fas fa-home":"fas fa-arrow-left","me-2"])},null,2),d(" "+u(T.value?"V·ªÅ trang ch·ªß":"Quay l·∫°i gi·ªè h√†ng"),1)]),_:1},8,["to"])])])]))])])}}},pn=_e(hn,[["__scopeId","data-v-421d7619"]]);export{pn as default};
