import{_ as q,K as B,m as F,r,q as f,A as R,h as J,c as m,a as e,l as A,t as d,f as P,g as c,s as b,Q as S,d as h,w as V,v as Z,b as G,L as $,i as Q,j as W,k as X,o as p,O as Y}from"./index-jpswdiZ0.js";const ss={class:"profile-page"},es={class:"container py-5"},ts={class:"row"},as={class:"col-lg-3 mb-4"},ls={class:"card shadow-sm border-0"},os={class:"card-body text-center"},ns={class:"position-relative d-inline-block mb-3"},is=["src","alt"],rs={class:"mb-1"},ds={class:"text-muted mb-0"},us={class:"text-muted"},cs={class:"card shadow-sm border-0 mt-3"},vs={class:"card-body"},ms={class:"row text-center"},ps={class:"col-6"},hs={class:"border-end"},fs={class:"text-primary mb-0"},bs={class:"col-6"},gs={class:"text-success mb-0"},ys={class:"mt-2 text-center"},ws={class:"badge bg-info"},ks={class:"col-lg-9"},xs={class:"card shadow-sm border-0"},Ps={class:"card-header bg-white border-bottom"},_s={class:"nav nav-tabs card-header-tabs",role:"tablist"},Cs={class:"nav-item"},Ts={class:"nav-item"},Ns={class:"nav-item"},Ds={class:"card-body"},Ss={class:"tab-content"},$s={key:0,class:"alert alert-success alert-dismissible fade show",role:"alert"},Ms={key:1,class:"alert alert-danger alert-dismissible fade show",role:"alert"},As={class:"row"},Vs={class:"col-md-6 mb-3"},Is={class:"input-group"},Es=["value"],Us={class:"col-md-6 mb-3"},zs={class:"input-group"},Hs={class:"col-md-6 mb-3"},Ks={class:"input-group"},Ls=["value"],Os={class:"col-md-6 mb-3"},js={class:"input-group"},qs=["value"],Bs={class:"col-12 mb-3"},Fs={class:"input-group"},Rs=["value"],Js={class:"d-flex gap-2"},Zs=["disabled"],Gs={key:0,class:"fas fa-save me-2"},Qs={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},Ws={class:"tab-content"},Xs={key:0,class:"alert alert-success alert-dismissible fade show",role:"alert",style:{"background-color":"#d4edda !important","border-color":"#c3e6cb !important",color:"#155724 !important"}},Ys={key:1,class:"alert alert-danger alert-dismissible fade show",role:"alert",style:{"background-color":"#f8d7da !important","border-color":"#f5c6cb !important",color:"#721c24 !important"}},se={class:"row"},ee={class:"col-md-6"},te={class:"mb-3"},ae={class:"input-group"},le=["type"],oe={class:"mb-3"},ne={class:"input-group"},ie=["type"],re={class:"mb-3"},de={class:"input-group"},ue=["type"],ce={class:"d-flex gap-2"},ve=["disabled"],me={key:0,class:"fas fa-key me-2"},pe={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},he={class:"tab-content"},fe={class:"text-center py-5"},be={__name:"Profile",setup(ge){const D=F(),{user:u,isLoggedIn:I,validateProfileAccess:M,updateCustomerProfile:E}=B(),U=()=>document.cookie.split("; ").find(a=>a.startsWith("easymart-token="))?.split("=")[1];I.value||D.push("/login");const v=r("profile"),l=r({name:"",email:"",phone:"",birthDate:"",address:""}),n=r({currentPassword:"",newPassword:"",confirmPassword:""}),g=r(!1),y=r(!1),_=r(""),w=r(""),k=r(""),i=r(""),C=r(!1),T=r(!1),N=r(!1),o=f(()=>u.value?.customerInfo||{}),z=f(()=>o.value.hoTen||u.value?.name||"User"),H=f(()=>u.value?.email||"No email"),K=f(()=>o.value.ngayTao||u.value?.joinDate);f(()=>o.value.tongDonHang||u.value?.totalOrders||0),f(()=>o.value.tongChiTieu||u.value?.totalSpent||0),f(()=>({formName:l.value.name,customerName:o.value.hoTen,userValue:u.value?.customerInfo?.hoTen,formPhone:l.value.phone,customerPhone:o.value.sdt,formAddress:l.value.address,customerAddress:o.value.diaChi}));const L=a=>{if(!a)return"Ch∆∞a c√≥ th√¥ng tin";try{let s;if(typeof a=="string")s=new Date(a);else if(a instanceof Date)s=a;else return"Ch∆∞a c√≥ th√¥ng tin";return isNaN(s.getTime())?"Ch∆∞a c√≥ th√¥ng tin":s.toLocaleDateString("vi-VN")}catch(s){return console.error("Date formatting error:",s),"Ch∆∞a c√≥ th√¥ng tin"}},O=async()=>{w.value="",_.value="",g.value=!0;try{const a={hoTen:l.value.name,sdt:l.value.phone,ngaySinh:l.value.birthDate,diaChi:l.value.address};console.log("üìù Profile form data:",l.value),console.log("üì§ Update data prepared:",a),console.log("üì± Phone number being sent:",l.value.phone);const s=await E(a);s.success?(_.value=s.message||"Th√¥ng tin c√° nh√¢n ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t th√†nh c√¥ng!",await M()):w.value=s.error||"C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t th√¥ng tin!"}catch(a){console.error("Profile update error:",a),w.value="C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t th√¥ng tin!"}finally{g.value=!1}},j=async()=>{if(i.value="",k.value="",n.value.newPassword!==n.value.confirmPassword){i.value="M·∫≠t kh·∫©u m·ªõi kh√¥ng kh·ªõp!";return}if(n.value.newPassword.length<6){i.value="M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!";return}if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*?&]{6,}$/.test(n.value.newPassword)){i.value="M·∫≠t kh·∫©u ph·∫£i ch·ª©a c·∫£ ch·ªØ v√† s·ªë!";return}if(n.value.newPassword===n.value.currentPassword){i.value="M·∫≠t kh·∫©u m·ªõi kh√¥ng ƒë∆∞·ª£c gi·ªëng m·∫≠t kh·∫©u hi·ªán t·∫°i!";return}y.value=!0;try{const s=U();if(!s){i.value="Kh√¥ng c√≥ token x√°c th·ª±c!";return}const x=await fetch(`${Y.BASE_URL}/api/nguoidung/change-password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({oldPassword:n.value.currentPassword,newPassword:n.value.newPassword,confirmPassword:n.value.confirmPassword})}),t=await x.json();x.ok?t.success||t.message?.includes("th√†nh c√¥ng")||t.message?.includes("success")?(k.value="M·∫≠t kh·∫©u ƒë√£ ƒë∆∞·ª£c thay ƒë·ªïi th√†nh c√¥ng!",n.value.currentPassword="",n.value.newPassword="",n.value.confirmPassword="",C.value=!1,T.value=!1,N.value=!1,setTimeout(()=>{k.value=""},3e3)):i.value=t.message||t.error||"C√≥ l·ªói x·∫£y ra khi thay ƒë·ªïi m·∫≠t kh·∫©u!":i.value=t.message||t.error||`HTTP Error: ${x.status} ${x.statusText}`}catch(s){console.error("Change password error:",s),i.value="C√≥ l·ªói x·∫£y ra khi thay ƒë·ªïi m·∫≠t kh·∫©u!"}finally{y.value=!1}};return R(o,a=>{a&&Object.keys(a).length>0&&(console.log("üëÄ customerInfo changed:",a),l.value={name:a.hoTen||"",email:u.value?.email||"",phone:a.sdt||"",birthDate:a.ngaySinh||"",address:a.diaChi||""},console.log("üîÑ Form auto-updated from customerInfo:",l.value))},{immediate:!0}),J(async()=>{try{console.log("üöÄ Profile page mounted, starting validation...");const a=await M();a.success?(console.log("‚úÖ Profile validated successfully"),console.log("üë§ Current customerInfo:",o.value),o.value&&Object.keys(o.value).length>0?(l.value={name:o.value.hoTen||"",email:u.value?.email||"",phone:o.value.sdt||"",birthDate:o.value.ngaySinh||"",address:o.value.diaChi||""},console.log("üìù Form populated with customer data:",l.value),console.log("üè∑Ô∏è Name field value:",l.value.name),console.log("üì± Phone field value:",l.value.phone),console.log("üìç Address field value:",l.value.address)):console.log("‚ö†Ô∏è customerInfo is empty or undefined")):(console.error("‚ùå Profile validation failed:",a.error),D.push("/login"))}catch(a){console.error("‚ùå Profile initialization error:",a),D.push("/login")}}),(a,s)=>{const x=X("router-link");return p(),m("div",ss,[e("div",es,[e("div",ts,[e("div",as,[e("div",ls,[e("div",os,[e("div",ns,[e("img",{src:A(u)?.avatar||"https://via.placeholder.com/80",class:"rounded-circle",width:"80",height:"80",alt:A(u)?.name||"User"},null,8,is),s[18]||(s[18]=e("button",{class:"btn btn-sm btn-primary rounded-circle position-absolute bottom-0 end-0",style:{width:"24px",height:"24px",padding:"0"}},[e("i",{class:"fas fa-camera",style:{"font-size":"0.7rem"}})],-1))]),e("h5",rs,d(z.value),1),e("p",ds,d(H.value),1),e("small",us,"Tham gia t·ª´ "+d(L(K.value)),1)])]),e("div",cs,[e("div",vs,[s[21]||(s[21]=e("h6",{class:"card-title"},"Th√¥ng tin kh√°ch h√†ng",-1)),e("div",ms,[e("div",ps,[e("div",hs,[e("h6",fs,d(o.value?.maKH||"N/A"),1),s[19]||(s[19]=e("small",{class:"text-muted"},"M√£ KH",-1))])]),e("div",bs,[e("h6",gs,d(o.value?.diemTichLuy||0),1),s[20]||(s[20]=e("small",{class:"text-muted"},"ƒêi·ªÉm t√≠ch l≈©y",-1))])]),e("div",ys,[e("span",ws,d(o.value?.loaiKhachHang||"Th∆∞·ªùng"),1)])])])]),e("div",ks,[e("div",xs,[e("div",Ps,[e("ul",_s,[e("li",Cs,[e("button",{class:P(["nav-link",{active:v.value==="profile"}]),onClick:s[0]||(s[0]=t=>v.value="profile")},s[22]||(s[22]=[e("i",{class:"fas fa-user me-2"},null,-1),c("Th√¥ng tin c√° nh√¢n ")]),2)]),e("li",Ts,[e("button",{class:P(["nav-link",{active:v.value==="password"}]),onClick:s[1]||(s[1]=t=>v.value="password")},s[23]||(s[23]=[e("i",{class:"fas fa-lock me-2"},null,-1),c("ƒê·ªïi m·∫≠t kh·∫©u ")]),2)]),e("li",Ns,[e("button",{class:P(["nav-link",{active:v.value==="orders"}]),onClick:s[2]||(s[2]=t=>v.value="orders")},s[24]||(s[24]=[e("i",{class:"fas fa-shopping-bag me-2"},null,-1),c("ƒê∆°n h√†ng ")]),2)])])]),e("div",Ds,[b(e("div",Ss,[s[38]||(s[38]=e("h5",{class:"mb-4"},"Th√¥ng tin c√° nh√¢n",-1)),_.value?(p(),m("div",$s,[s[25]||(s[25]=e("i",{class:"fas fa-check-circle me-2"},null,-1)),c(d(_.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:s[3]||(s[3]=t=>_.value="")})])):h("",!0),w.value?(p(),m("div",Ms,[s[26]||(s[26]=e("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),c(d(w.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:s[4]||(s[4]=t=>w.value="")})])):h("",!0),e("form",{onSubmit:V(O,["prevent"])},[e("div",As,[e("div",Vs,[s[28]||(s[28]=e("label",{for:"name",class:"form-label"},"H·ªç v√† t√™n *",-1)),e("div",Is,[s[27]||(s[27]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-user"})],-1)),e("input",{value:o.value?.hoTen||l.value.name,onInput:s[5]||(s[5]=t=>l.value.name=t.target.value),type:"text",class:"form-control",id:"name",required:"",placeholder:"Nh·∫≠p h·ªç v√† t√™n"},null,40,Es)])]),e("div",Us,[s[30]||(s[30]=e("label",{for:"email",class:"form-label"},"Email *",-1)),e("div",zs,[s[29]||(s[29]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-envelope"})],-1)),b(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>l.value.email=t),type:"email",class:"form-control",id:"email",required:"",placeholder:"Nh·∫≠p email",disabled:""},null,512),[[Z,l.value.email]])]),s[31]||(s[31]=e("small",{class:"text-muted"},"Email kh√¥ng th·ªÉ thay ƒë·ªïi",-1))]),e("div",Hs,[s[33]||(s[33]=e("label",{for:"phone",class:"form-label"},"S·ªë ƒëi·ªán tho·∫°i",-1)),e("div",Ks,[s[32]||(s[32]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-phone"})],-1)),e("input",{value:o.value?.sdt||l.value.phone,onInput:s[7]||(s[7]=t=>l.value.phone=t.target.value),type:"tel",class:"form-control",id:"phone",placeholder:"Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"},null,40,Ls)])]),e("div",Os,[s[35]||(s[35]=e("label",{for:"birthDate",class:"form-label"},"Ng√†y sinh",-1)),e("div",js,[s[34]||(s[34]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-calendar"})],-1)),e("input",{value:o.value?.ngaySinh||l.value.birthDate,onInput:s[8]||(s[8]=t=>l.value.birthDate=t.target.value),type:"date",class:"form-control",id:"birthDate"},null,40,qs)])]),e("div",Bs,[s[37]||(s[37]=e("label",{for:"address",class:"form-label"},"ƒê·ªãa ch·ªâ",-1)),e("div",Fs,[s[36]||(s[36]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-map-marker-alt"})],-1)),e("textarea",{value:o.value?.diaChi||l.value.address,onInput:s[9]||(s[9]=t=>l.value.address=t.target.value),class:"form-control",id:"address",rows:"3",placeholder:"Nh·∫≠p ƒë·ªãa ch·ªâ"},null,40,Rs)])])]),e("div",Js,[e("button",{type:"submit",class:"btn btn-primary",disabled:g.value},[g.value?h("",!0):(p(),m("i",Gs)),g.value?(p(),m("span",Qs)):h("",!0),c(" "+d(g.value?"ƒêang c·∫≠p nh·∫≠t...":"C·∫≠p nh·∫≠t th√¥ng tin"),1)],8,Zs)])],32)],512),[[S,v.value==="profile"]]),b(e("div",Ws,[s[49]||(s[49]=e("h5",{class:"mb-4"},"ƒê·ªïi m·∫≠t kh·∫©u",-1)),k.value?(p(),m("div",Xs,[s[39]||(s[39]=e("i",{class:"fas fa-check-circle me-2"},null,-1)),c(d(k.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:s[10]||(s[10]=t=>k.value="")})])):h("",!0),i.value?(p(),m("div",Ys,[s[40]||(s[40]=e("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),c(d(i.value)+" ",1),e("button",{type:"button",class:"btn-close",onClick:s[11]||(s[11]=t=>i.value="")})])):h("",!0),e("form",{onSubmit:V(j,["prevent"])},[e("div",se,[e("div",ee,[e("div",te,[s[42]||(s[42]=e("label",{for:"currentPassword",class:"form-label"},"M·∫≠t kh·∫©u hi·ªán t·∫°i *",-1)),e("div",ae,[s[41]||(s[41]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-lock"})],-1)),b(e("input",{"onUpdate:modelValue":s[12]||(s[12]=t=>n.value.currentPassword=t),type:C.value?"text":"password",class:"form-control",id:"currentPassword",required:"",placeholder:"Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i"},null,8,le),[[$,n.value.currentPassword]]),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:s[13]||(s[13]=t=>C.value=!C.value)},[e("i",{class:P(C.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),e("div",oe,[s[44]||(s[44]=e("label",{for:"newPassword",class:"form-label"},"M·∫≠t kh·∫©u m·ªõi *",-1)),e("div",ne,[s[43]||(s[43]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-lock"})],-1)),b(e("input",{"onUpdate:modelValue":s[14]||(s[14]=t=>n.value.newPassword=t),type:T.value?"text":"password",class:"form-control",id:"newPassword",required:"",placeholder:"Nh·∫≠p m·∫≠t kh·∫©u m·ªõi",minlength:"6"},null,8,ie),[[$,n.value.newPassword]]),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:s[15]||(s[15]=t=>T.value=!T.value)},[e("i",{class:P(T.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])]),s[45]||(s[45]=e("div",{class:"form-text"},"M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±",-1))]),e("div",re,[s[47]||(s[47]=e("label",{for:"confirmPassword",class:"form-label"},"X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi *",-1)),e("div",de,[s[46]||(s[46]=e("span",{class:"input-group-text"},[e("i",{class:"fas fa-lock"})],-1)),b(e("input",{"onUpdate:modelValue":s[16]||(s[16]=t=>n.value.confirmPassword=t),type:N.value?"text":"password",class:"form-control",id:"confirmPassword",required:"",placeholder:"Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi"},null,8,ue),[[$,n.value.confirmPassword]]),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:s[17]||(s[17]=t=>N.value=!N.value)},[e("i",{class:P(N.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])])]),s[48]||(s[48]=G('<div class="col-md-6" data-v-77996657><div class="card bg-light border-0 h-100" data-v-77996657><div class="card-body" data-v-77996657><h6 class="card-title" data-v-77996657><i class="fas fa-shield-alt text-primary me-2" data-v-77996657></i>B·∫£o m·∫≠t m·∫≠t kh·∫©u </h6><ul class="list-unstyled mb-0" data-v-77996657><li class="mb-2" data-v-77996657><i class="fas fa-check text-success me-2" data-v-77996657></i> S·ª≠ d·ª•ng √≠t nh·∫•t 6 k√Ω t·ª± </li><li class="mb-2" data-v-77996657><i class="fas fa-check text-success me-2" data-v-77996657></i> K·∫øt h·ª£p ch·ªØ v√† s·ªë </li><li class="mb-2" data-v-77996657><i class="fas fa-check text-success me-2" data-v-77996657></i> Kh√¥ng s·ª≠ d·ª•ng th√¥ng tin c√° nh√¢n </li><li class="mb-0" data-v-77996657><i class="fas fa-check text-success me-2" data-v-77996657></i> Thay ƒë·ªïi ƒë·ªãnh k·ª≥ </li></ul></div></div></div>',1))]),e("div",ce,[e("button",{type:"submit",class:"btn btn-primary",disabled:y.value},[y.value?h("",!0):(p(),m("i",me)),y.value?(p(),m("span",pe)):h("",!0),c(" "+d(y.value?"ƒêang c·∫≠p nh·∫≠t...":"ƒê·ªïi m·∫≠t kh·∫©u"),1)],8,ve)])],32)],512),[[S,v.value==="password"]]),b(e("div",he,[s[54]||(s[54]=e("h5",{class:"mb-4"},"ƒê∆°n h√†ng c·ªßa t√¥i",-1)),e("div",fe,[s[51]||(s[51]=e("i",{class:"fas fa-shopping-bag text-muted",style:{"font-size":"3rem"}},null,-1)),s[52]||(s[52]=e("h6",{class:"mt-3 text-muted"},"Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o",-1)),s[53]||(s[53]=e("p",{class:"text-muted"},"H√£y b·∫Øt ƒë·∫ßu mua s·∫Øm ƒë·ªÉ xem l·ªãch s·ª≠ ƒë∆°n h√†ng t·∫°i ƒë√¢y",-1)),Q(x,{to:"/",class:"btn btn-primary"},{default:W(()=>s[50]||(s[50]=[e("i",{class:"fas fa-shopping-cart me-2"},null,-1),c("Mua s·∫Øm ngay ")])),_:1,__:[50]})])],512),[[S,v.value==="orders"]])])])])])])])}}},ke=q(be,[["__scopeId","data-v-77996657"]]);export{ke as default};
