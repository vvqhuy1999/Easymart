import{_ as D,u as N,r as f,h as P,D as $,i as G,E as B,c as n,a as s,d as M,k as d,l as y,m as R,g as c,f as b,t as v,F as L,e as F,J as _,C as p,p as H,o,y as x,P as O}from"./index-BLaNa9iG.js";const U={class:"category-page"},j={class:"container py-5 mt-5"},K={"aria-label":"breadcrumb",class:"mb-4"},W={class:"breadcrumb"},Y={class:"breadcrumb-item"},z={class:"breadcrumb-item active","aria-current":"page"},J={key:0,class:"category-header mb-5 text-center"},q={class:"category-icon mb-3"},Q={class:"category-title"},X={class:"text-muted"},Z={key:1,class:"text-center py-5"},aa={key:2,class:"text-center py-5"},ea={class:"error-state"},sa={key:3,class:"row g-4"},ta={key:4,class:"text-center py-5"},na={class:"no-products"},oa={__name:"Category",setup(ia){const C=H(),T=$(),{formatPrice:A,addToCart:S,getCategoryById:k,showNotification:I}=N(),i=f([]),m=f(!1),u=f(!1),r=P(()=>T.params.id),l=P(()=>k(r.value)),g=async()=>{if(r.value)try{m.value=!0,u.value=!1;const t=await fetch(`${_}${p.PRODUCTS.BY_CATEGORY_ACTIVE(r.value)}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();console.log("[Category] API raw length:",Array.isArray(e)?e.length:-1),i.value=e.map(a=>({id:a.maSP||a.id,name:a.tenSP||a.name,price:a.giaHienTai||a.giaBan||a.price,originalPrice:a.giaGoc||a.originalPrice,categoryId:a.loaiSanPham?.maLoaiSP||a.categoryId,categoryName:a.loaiSanPham?.tenLoai||a.categoryName,image:`${_}${p.IMAGES.SERVE_IMAGE(a.maSP+"_main.jfif")}`,images:p.IMAGES.PRODUCT_IMAGES(a.maSP).map(V=>`${_}${V}`),description:a.moTa||a.description,isFlashSale:a.isFlashSale||!1,isActive:a.isActive!==!1,stock:a.trongLuong||a.stock||0,unit:a.donViTinh||a.unit||"cái",rating:a.danhGia||a.rating||4.5,reviews:a.danhGia||a.reviews||[]})),console.log("[Category] Mapped products:",i.value.map(a=>({id:a.id,price:a.price,giaHienTai:a.giaHienTai})))}catch(t){console.error(`Failed to load products for category ${r.value}:`,t),u.value=!0,i.value=[]}finally{m.value=!1}},w=t=>{C.push({name:"ProductDetail",params:{id:t}})},E=t=>{I("Đã thêm vào danh sách yêu thích!","success")};return G(()=>{g()}),B(r,()=>{g()}),(t,e)=>{const a=R("router-link");return o(),n("div",U,[s("div",j,[s("nav",K,[s("ol",W,[s("li",Y,[d(a,{to:"/",class:"text-decoration-none"},{default:y(()=>e[0]||(e[0]=[s("i",{class:"fas fa-home"},null,-1),c(" Trang chủ ")])),_:1,__:[0]})]),s("li",z,[s("i",{class:b(l.value?.icon)},null,2),c(" "+v(l.value?.name||"Danh mục"),1)])])]),l.value?(o(),n("div",J,[s("div",q,[s("i",{class:b(`${l.value.icon} fa-4x text-primary`)},null,2)]),s("h1",Q,v(l.value.name),1),s("p",X,"Khám phá "+v(i.value.length)+" sản phẩm chất lượng",1)])):M("",!0),m.value?(o(),n("div",Z,e[1]||(e[1]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Đang tải sản phẩm...")],-1),s("p",{class:"text-muted mt-3"},"Đang tải sản phẩm trong danh mục...",-1)]))):u.value?(o(),n("div",aa,[s("div",ea,[e[4]||(e[4]=s("i",{class:"fas fa-exclamation-triangle fa-4x text-danger mb-4"},null,-1)),e[5]||(e[5]=s("h3",{class:"text-danger mb-3"},"Không thể tải sản phẩm",-1)),e[6]||(e[6]=s("p",{class:"text-muted mb-4"},"Đã xảy ra lỗi khi tải sản phẩm từ API",-1)),s("button",{onClick:g,class:"btn btn-primary me-2"},e[2]||(e[2]=[s("i",{class:"fas fa-refresh me-2"},null,-1),c("Thử lại ")])),d(a,{to:"/",class:"btn btn-outline-secondary"},{default:y(()=>e[3]||(e[3]=[s("i",{class:"fas fa-arrow-left me-2"},null,-1),c("Về trang chủ ")])),_:1,__:[3]})])])):i.value.length>0?(o(),n("div",sa,[(o(!0),n(L,null,F(i.value,h=>(o(),n("div",{key:h.id,class:"col-6 col-md-4 col-lg-3"},[d(O,{product:h,formatPrice:x(A),onAddToCart:x(S),onViewDetail:w,onAddToWishlist:E},null,8,["product","formatPrice","onAddToCart"])]))),128))])):(o(),n("div",ta,[s("div",na,[e[8]||(e[8]=s("i",{class:"fas fa-box-open fa-4x text-muted mb-4"},null,-1)),e[9]||(e[9]=s("h3",{class:"text-muted mb-3"},"Chưa có sản phẩm",-1)),e[10]||(e[10]=s("p",{class:"text-muted mb-4"},"Danh mục này hiện chưa có sản phẩm nào",-1)),d(a,{to:"/",class:"btn btn-primary"},{default:y(()=>e[7]||(e[7]=[s("i",{class:"fas fa-arrow-left me-2"},null,-1),c(" Về trang chủ ")])),_:1,__:[7]})])]))])])}}},la=D(oa,[["__scopeId","data-v-f3b9ed86"]]);export{la as default};
